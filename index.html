<!DOCTYPE html><html><head><title>Two-Factor Authentication with Authy</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Two-Factor Authentication with Authy"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Two-Factor Authentication with Authy</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement two-factor authentication (2FA) in your web app with Twilio-powered Authy. 2FA helps further secure your users' data by validating more than just a password. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Application Setup" class="chapter"><div data-title="How it Works" data-file="Authy2FA/Models/IdentityModels.cs" data-highlight="" class="step"><h2 id="how-it-works">How It Works</h2>
<p>Adding two-factor authentication (2FA) to your web application can help increase the security of your user&#39;s data. <a href="http://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a> determines the identity of a user by validating one or more of the following &quot;factors&quot;:</p>
<ul>
<li><em>Knowledge Factors</em> (Something a user knows, like a password)</li>
<li><em>Posession Factors</em> (Something a user has, like a mobile phone)</li>
<li><em>Inheritance Factors</em> (Something a user is, like a person with a unique finger print)</li>
</ul>
<p>We&#39;re about to walk you through a sample application that implements a simple login system with a <em>knowledge factor</em> and a <em>posession factor</em>. For the knowledge factor, we will use a standard username/password system. For the possession factor, we will validate that the user has their mobile phone by sending them a one-time passcode in a text message <a href="http://www.authy.com/">sent with Authy via Twilio</a>. Here&#39;s how this works at a high level:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-high-level.png" alt="2FA High Level"></p>
<p>Now it&#39;s time to look at some code! We&#39;ll begin by understanding the moving parts of this example ASP.NET MVC application before diving into the actual implementation of the login flow.</p>
</div><div data-title="Application Configuration" data-file="Authy2FA/Web.config.sample" data-mode="xml" data-highlight="14-20" class="step"><h2 id="application-configuration">Application Configuration</h2>
<p>If you haven&#39;t already, now is the time to <a href="https://dashboard.authy.com/signup">sign up for Authy</a>. Create your first application, naming it whatever you wish. After you create your application, your &quot;production&quot; API key will be visible on your <a href="https://dashboard.authy.com">dashboard</a>:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-authy-dashboard.png" alt="Authy Dashboard"></p>
<p>You&#39;ll use this production key inside your <code>Web.config</code> file at the root of your web application project. Look for the <code>AuthyKey</code> property in this file, and change it to contain your Authy production key.  </p>
<h2 id="note">Note</h2>
<p>If you were to download or clone this application project, you would need to rename <code>Web.config.sample</code> to <code>Web.config</code> so that file would be used in your project.</p>
<h2 id="dependencies">Dependencies</h2>
<p>We&#39;re using mostly standard MVC namespaces for this project type with one notable exception - we&#39;re also using <a href="https://www.nuget.org/packages/Authy.Net/">the Authy.Net NuGet package</a> to make interacting with the Authy APIs a bit simpler. This package can be installed from the package manager UI within Visual Studio.</p>
<p>Now that we understand how our project is configured, let&#39;s take a look at how we need to configure the Identity system to use Authy as a 2FA provider.</p>
</div></div><div data-title="Configuring ASP.NET Identity System" class="chapter"><div data-title="Updating the User Model" data-file="Authy2FA/Models/IdentityModels.cs" data-highlight="10-12" class="step"><h2 id="updating-the-user-model">Updating the User Model</h2>
<p>The Identity system has a few persistent Entity Framework models that contain profile information about the user. We can use these largely unchanged, but there is one extra bit of data we need to track about the user - an Authy user ID. We use this ID for Authy API requests to send 2FA validation tokens and to verify the tokens they input during the login process.</p>
<p>We&#39;re using <a href="http://www.asp.net/mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application">code first migrations</a> in this project, so we declare a new <code>string</code> property on the User model to contain their Authy ID, which we will populate later.</p>
<p>When running this project locally, you would need to open the Package Manager console and enter the <code>Enable-Migrations</code> command first. You can update the database with the migrations generated for this model already with the <code>Update-Database</code> command in the package manager console.  This migration should exist already if you downloaded the project from GitHub</p>
<p>That&#39;s all we need to change at the model level, but we&#39;re not done configuring the Identity system yet.  Let&#39;s see how we configure Authy as the 2FA provider for our application..</p>
</div><div data-title="Register Authy as a 2FA Provider" data-file="Authy2FA/App_Start/IdentityConfig.cs" data-highlight="77-78" class="step"><h2 id="register-authy-as-a-2fa-provider">Register Authy as a 2FA Provider</h2>
<p><code>IdentityConfig.cs</code> is the primary configuration file for the Identity system in our application. In this file, you can configure everything from password strength requirements to 2FA providers, which we do in these two lines of code here.</p>
<p>Explaining the features of Identity namespace is not something we&#39;ll be able to do justice to in this tutorial, so if you&#39;d like to learn more about how Identity is configured, token providers, and the other specifics of the API, you might consider these resources from Microsoft:</p>
<ul>
<li><a href="http://www.asp.net/identity">Getting Started with Identity</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/microsoft.aspnet.identity(v=vs.108">Identity Namespace API docs</a>.aspx)</li>
</ul>
<p>Let&#39;s take a brief look at the <code>AuthyTokenProvider</code> class to see what it needs to do to function as a 2FA provider for our application.</p>
</div><div data-title="The Authy 2FA Provider" data-file="Authy2FA/AuthyProvider/AuthyProvider.cs" class="step"><h2 id="the-authy-2fa-provider">The Authy 2FA Provider</h2>
<p>In this file, we create the <code>AuthyProvider</code> namespace, which contains a <code>AuthyTokenProvider</code> class. This class <a href="http://www.asp.net/identity/overview/features-api/two-factor-authentication-using-sms-and-email-with-aspnet-identity#reg">is used by ASP.NET Identity</a> to both send a verification token to a device, and to verify the token that was sent.</p>
<p>The two key methods to note here are <code>NotifyAsync</code> and <code>ValidateAsync</code>. These methods use the Authy client to send a one-time password and validate a one-time password, respectively.  Each depends on being provided with an Identity user class with a persistent <code>AuthyId</code> string property, which we created on the model earlier.</p>
<p>Now that we&#39;ve made it possible to use Authy for 2FA, let&#39;s see how a user would opt in to using 2FA in the first place.</p>
</div><div data-title="Enabling Two-Factor Authentication" data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="114-134" class="step"><h2 id="enabling-two-factor-authentication-for-a-user">Enabling Two-Factor Authentication for a User</h2>
<p>In the default setup for an ASP.NET MVC app using Identity for authentication, a user must sign up first, and then elect to enable two-factor authentication after creating an account. To use Authy for 2FA, we need to add an <a href="https://docs.authy.com/#section-Enabling_two-factor_on_a_user">Authy User</a> for them associated with the phone number they enter.</p>
<p>This is the controller method that handles adding the phone number for the 2FA step. We&#39;ve added code here to use the Authy API client to create a new Authy user, and to store their Authy user ID on the Identity model in our database. Now the user account in our database is tied to an Authy user, so we can verify any one-time password codes sent to the user.</p>
<p>Now that our user has elected 2FA for login, let&#39;s step through the actual login flow.</p>
</div></div><div data-title="Implementing the Login Flow" class="chapter"><div data-title="Implementing the Login Flow" data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="" class="step"><h2 id="implementing-the-login-flow">Implementing the Login Flow</h2>
<p>When you generate a new project for ASP.NET MVC, a lot of the front-end code and controller logic is generated for you. The project combines jQuery, <a href="http://getbootstrap.com/">Bootstrap</a>, and <a href="http://modernizr.com/">Modernizr</a> along with C# code at the controller level to create a fully baked user management system.</p>
<p>At a high level, our 2FA login flow will look like this:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow.png" alt="2FA Flow Chart"></p>
<p>Let&#39;s step through this login flow to see what&#39;s happening at each step.</p>
</div><div data-title="The Login Form" data-file="Authy2FA/Views/Account/Login.cshtml" data-highlight="17-30" data-mode="html" class="step"><h2 id="the-login-form">The Login Form</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow2.png" alt="2FA Flow Chart Step 2"></p>
<p>On this login form, the user will attempt to validate the first &quot;factor&quot; of their identity, which is a password they already know. The user will enter their e-mail address and password in this form, and will send it to our server for validation.</p>
<p>Let&#39;s check out the code that handles this form submission next.</p>
</div><div data-title="Validating the E-Mail and Password" data-file="Authy2FA/Controllers/AccountController.cs" data-highlight="66-92" class="step"><h2 id="validating-the-e-mail-and-password">Validating the E-Mail and Password</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow3.png" alt="2FA Flow Chart Step 3"></p>
<p>On the server, we receive the e-mail address and password the user entered on the <a href="http://blogs.msdn.com/b/rickandy/archive/2011/01/28/dynamic-v-strongly-typed-views.aspx">view model</a> and asynchronoously check to see if they are valid.  If the e-mail and password combination match (and the user has two-factor authentication enabled), we will receive a <code>SignInStatus.RequiresVerification</code> result.  From there, we redirect to the <code>SendCode</code> action in this same controller.</p>
<p>This will display a form that will allow the user to select a 2FA provider from a drop-down list. In this example, Authy is the only choice. When the user submits this form, our <code>AuthyTokenProvider</code> class will take over and send the verification code via SMS.</p>
</div><div data-title="Entering the Verification Code" data-file="Authy2FA/Views/Account/VerifyCode.cshtml" data-highlight="15-20" data-mode="html" class="step"><h2 id="entering-the-verification-code">Entering the Verification Code</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow7.png" alt="2FA Flow Chart Step 7"></p>
<p>Once the code is sent, we display a form for the user to enter the one-time password that was sent to them via SMS.</p>
</div><div data-title="Validating the Code" data-file="Authy2FA/Controllers/AccountController.cs" data-highlight="109-135" class="step"><h2 id="validating-the-code">Validating the Code</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow8.png" alt="2FA Flow Chart Step 8"></p>
<p>On the server, we use the <code>SignInManager</code> once again to validate the 2FA code that was entered by the user on the form. This will, eventually, use the <code>ValidateAsync</code> method on our <code>AuthyTokenProvider</code> class we saw earlier.  If the code is valid, we&#39;re all set with an authenticated session!</p>
</div><div data-title="Accessing Protected Resources" data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="13-16" class="step"><h2 id="accessing-protected-resources">Accessing Protected Resources</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow10.png" alt="2FA Flow Chart Step 10"></p>
<p>Now that we have an authenticated session, we can annotate other controllers in our application with <code>[Authorize]</code> to make sure an authenticated user only is allowed to see these items. Identity / Entity Framework also have finer-grained access controls you can use as well.</p>
</div><div data-title="All Done!" data-file="Authy2FA/Controllers/ManageController.cs" class="step"><h2 id="all-done-">All Done!</h2>
<p>And with just a bit of code to integrate Authy, our ASP.NET MVC application can now take advantage of high-level features Authy provides like a native 2FA app, user management and health checking, and much more.</p>
<p>We hope you found this tutorial useful - if you have any questions or feedback, please let us know! Send a note to <a href="mailto:docs@twilio.com">docs@twilio.com</a> to say hi.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="Authy2FA/Models/IdentityModels.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtLkRhdGEuRW50aXR5Owp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ2xhaW1zOwp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOwp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5Owp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5LkVudGl0eUZyYW1ld29yazsKCm5hbWVzcGFjZSBBdXRoeTJGQS5Nb2RlbHMKewogICAgLy8gWW91IGNhbiBhZGQgcHJvZmlsZSBkYXRhIGZvciB0aGUgdXNlciBieSBhZGRpbmcgbW9yZSBwcm9wZXJ0aWVzIHRvIHlvdXIgQXBwbGljYXRpb25Vc2VyIGNsYXNzLCBwbGVhc2UgdmlzaXQgaHR0cDovL2dvLm1pY3Jvc29mdC5jb20vZndsaW5rLz9MaW5rSUQ9MzE3NTk0IHRvIGxlYXJuIG1vcmUuCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25Vc2VyIDogSWRlbnRpdHlVc2VyCiAgICB7CiAgICAgICAgcHVibGljIHN0cmluZyBBdXRoeUlkIHsgZ2V0OyBzZXQ7IH0KCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8Q2xhaW1zSWRlbnRpdHk+IEdlbmVyYXRlVXNlcklkZW50aXR5QXN5bmMoVXNlck1hbmFnZXI8QXBwbGljYXRpb25Vc2VyPiBtYW5hZ2VyKQogICAgICAgIHsKICAgICAgICAgICAgLy8gTm90ZSB0aGUgYXV0aGVudGljYXRpb25UeXBlIG11c3QgbWF0Y2ggdGhlIG9uZSBkZWZpbmVkIGluIENvb2tpZUF1dGhlbnRpY2F0aW9uT3B0aW9ucy5BdXRoZW50aWNhdGlvblR5cGUKICAgICAgICAgICAgdmFyIHVzZXJJZGVudGl0eSA9IGF3YWl0IG1hbmFnZXIuQ3JlYXRlSWRlbnRpdHlBc3luYyh0aGlzLCBEZWZhdWx0QXV0aGVudGljYXRpb25UeXBlcy5BcHBsaWNhdGlvbkNvb2tpZSk7CiAgICAgICAgICAgIC8vIEFkZCBjdXN0b20gdXNlciBjbGFpbXMgaGVyZQogICAgICAgICAgICByZXR1cm4gdXNlcklkZW50aXR5OwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25EYkNvbnRleHQgOiBJZGVudGl0eURiQ29udGV4dDxBcHBsaWNhdGlvblVzZXI+CiAgICB7CiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uRGJDb250ZXh0KCkKICAgICAgICAgICAgOiBiYXNlKCJEZWZhdWx0Q29ubmVjdGlvbiIsIHRocm93SWZWMVNjaGVtYTogZmFsc2UpCiAgICAgICAgewogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBBcHBsaWNhdGlvbkRiQ29udGV4dCBDcmVhdGUoKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBBcHBsaWNhdGlvbkRiQ29udGV4dCgpOwogICAgICAgIH0KICAgIH0KfQ==</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Web.config.sample" data-mode="xml">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLQogIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0byBjb25maWd1cmUgeW91ciBBU1AuTkVUIGFwcGxpY2F0aW9uLCBwbGVhc2UgdmlzaXQKICBodHRwOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJZD0zMDE4ODAKICAtLT4KPGNvbmZpZ3VyYXRpb24+CiAgPGNvbmZpZ1NlY3Rpb25zPgogICAgPCEtLSBGb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiBFbnRpdHkgRnJhbWV3b3JrIGNvbmZpZ3VyYXRpb24sIHZpc2l0IGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/TGlua0lEPTIzNzQ2OCAtLT4KICAgIDxzZWN0aW9uIG5hbWU9ImVudGl0eUZyYW1ld29yayIgdHlwZT0iU3lzdGVtLkRhdGEuRW50aXR5LkludGVybmFsLkNvbmZpZ0ZpbGUuRW50aXR5RnJhbWV3b3JrU2VjdGlvbiwgRW50aXR5RnJhbWV3b3JrLCBWZXJzaW9uPTYuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSIgcmVxdWlyZVBlcm1pc3Npb249ImZhbHNlIiAvPgogIDwvY29uZmlnU2VjdGlvbnM+CiAgPGNvbm5lY3Rpb25TdHJpbmdzPgogICAgPGFkZCBuYW1lPSJEZWZhdWx0Q29ubmVjdGlvbiIgY29ubmVjdGlvblN0cmluZz0iRGF0YSBTb3VyY2U9KExvY2FsRGIpXHYxMS4wO0F0dGFjaERiRmlsZW5hbWU9fERhdGFEaXJlY3Rvcnl8XGFzcG5ldC1BdXRoeTJGQS0yMDE1MDIyNTEwNDg1Ny5tZGY7SW5pdGlhbCBDYXRhbG9nPWFzcG5ldC1BdXRoeTJGQS0yMDE1MDIyNTEwNDg1NztJbnRlZ3JhdGVkIFNlY3VyaXR5PVRydWUiIHByb3ZpZGVyTmFtZT0iU3lzdGVtLkRhdGEuU3FsQ2xpZW50IiAvPgogIDwvY29ubmVjdGlvblN0cmluZ3M+CiAgPGFwcFNldHRpbmdzPgogICAgPGFkZCBrZXk9IndlYnBhZ2VzOlZlcnNpb24iIHZhbHVlPSIzLjAuMC4wIiAvPgogICAgPGFkZCBrZXk9IndlYnBhZ2VzOkVuYWJsZWQiIHZhbHVlPSJmYWxzZSIgLz4KICAgIDxhZGQga2V5PSJDbGllbnRWYWxpZGF0aW9uRW5hYmxlZCIgdmFsdWU9InRydWUiIC8+CiAgICA8YWRkIGtleT0iVW5vYnRydXNpdmVKYXZhU2NyaXB0RW5hYmxlZCIgdmFsdWU9InRydWUiIC8+CiAgICA8YWRkIGtleT0iQXV0aHlLZXkiIHZhbHVlPSJ5b3VyIGF1dGh5IHByb2R1Y3Rpb24ga2V5Ii8+CiAgPC9hcHBTZXR0aW5ncz4KICA8c3lzdGVtLndlYj4KICAgIDxhdXRoZW50aWNhdGlvbiBtb2RlPSJOb25lIiAvPgogICAgPGNvbXBpbGF0aW9uIGRlYnVnPSJ0cnVlIiB0YXJnZXRGcmFtZXdvcms9IjQuNSIgLz4KICAgIDxodHRwUnVudGltZSB0YXJnZXRGcmFtZXdvcms9IjQuNSIgLz4KICA8L3N5c3RlbS53ZWI+CiAgPHN5c3RlbS53ZWJTZXJ2ZXI+CiAgICA8bW9kdWxlcz4KICAgICAgPHJlbW92ZSBuYW1lPSJGb3Jtc0F1dGhlbnRpY2F0aW9uIiAvPgogICAgPC9tb2R1bGVzPgogIDwvc3lzdGVtLndlYlNlcnZlcj4KICA8cnVudGltZT4KICAgIDxhc3NlbWJseUJpbmRpbmcgeG1sbnM9InVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206YXNtLnYxIj4KICAgICAgPGRlcGVuZGVudEFzc2VtYmx5PgogICAgICAgIDxhc3NlbWJseUlkZW50aXR5IG5hbWU9Ik1pY3Jvc29mdC5Pd2luIiBwdWJsaWNLZXlUb2tlbj0iMzFiZjM4NTZhZDM2NGUzNSIgLz4KICAgICAgICA8YmluZGluZ1JlZGlyZWN0IG9sZFZlcnNpb249IjAuMC4wLjAtMy4wLjAuMCIgbmV3VmVyc2lvbj0iMy4wLjAuMCIgLz4KICAgICAgPC9kZXBlbmRlbnRBc3NlbWJseT4KICAgICAgPGRlcGVuZGVudEFzc2VtYmx5PgogICAgICAgIDxhc3NlbWJseUlkZW50aXR5IG5hbWU9Ik1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5Lk9BdXRoIiBwdWJsaWNLZXlUb2tlbj0iMzFiZjM4NTZhZDM2NGUzNSIgLz4KICAgICAgICA8YmluZGluZ1JlZGlyZWN0IG9sZFZlcnNpb249IjAuMC4wLjAtMy4wLjAuMCIgbmV3VmVyc2lvbj0iMy4wLjAuMCIgLz4KICAgICAgPC9kZXBlbmRlbnRBc3NlbWJseT4KICAgICAgPGRlcGVuZGVudEFzc2VtYmx5PgogICAgICAgIDxhc3NlbWJseUlkZW50aXR5IG5hbWU9Ik1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5LkNvb2tpZXMiIHB1YmxpY0tleVRva2VuPSIzMWJmMzg1NmFkMzY0ZTM1IiAvPgogICAgICAgIDxiaW5kaW5nUmVkaXJlY3Qgb2xkVmVyc2lvbj0iMC4wLjAuMC0zLjAuMC4wIiBuZXdWZXJzaW9uPSIzLjAuMC4wIiAvPgogICAgICA8L2RlcGVuZGVudEFzc2VtYmx5PgogICAgICA8ZGVwZW5kZW50QXNzZW1ibHk+CiAgICAgICAgPGFzc2VtYmx5SWRlbnRpdHkgbmFtZT0iTWljcm9zb2Z0Lk93aW4uU2VjdXJpdHkiIHB1YmxpY0tleVRva2VuPSIzMWJmMzg1NmFkMzY0ZTM1IiAvPgogICAgICAgIDxiaW5kaW5nUmVkaXJlY3Qgb2xkVmVyc2lvbj0iMC4wLjAuMC0zLjAuMC4wIiBuZXdWZXJzaW9uPSIzLjAuMC4wIiAvPgogICAgICA8L2RlcGVuZGVudEFzc2VtYmx5PgogICAgICA8ZGVwZW5kZW50QXNzZW1ibHk+CiAgICAgICAgPGFzc2VtYmx5SWRlbnRpdHkgbmFtZT0iTmV3dG9uc29mdC5Kc29uIiBjdWx0dXJlPSJuZXV0cmFsIiBwdWJsaWNLZXlUb2tlbj0iMzBhZDRmZTZiMmE2YWVlZCIgLz4KICAgICAgICA8YmluZGluZ1JlZGlyZWN0IG9sZFZlcnNpb249IjAuMC4wLjAtNi4wLjAuMCIgbmV3VmVyc2lvbj0iNi4wLjAuMCIgLz4KICAgICAgPC9kZXBlbmRlbnRBc3NlbWJseT4KICAgICAgPGRlcGVuZGVudEFzc2VtYmx5PgogICAgICAgIDxhc3NlbWJseUlkZW50aXR5IG5hbWU9IlN5c3RlbS5XZWIuSGVscGVycyIgcHVibGljS2V5VG9rZW49IjMxYmYzODU2YWQzNjRlMzUiIC8+CiAgICAgICAgPGJpbmRpbmdSZWRpcmVjdCBvbGRWZXJzaW9uPSIxLjAuMC4wLTMuMC4wLjAiIG5ld1ZlcnNpb249IjMuMC4wLjAiIC8+CiAgICAgIDwvZGVwZW5kZW50QXNzZW1ibHk+CiAgICAgIDxkZXBlbmRlbnRBc3NlbWJseT4KICAgICAgICA8YXNzZW1ibHlJZGVudGl0eSBuYW1lPSJTeXN0ZW0uV2ViLk12YyIgcHVibGljS2V5VG9rZW49IjMxYmYzODU2YWQzNjRlMzUiIC8+CiAgICAgICAgPGJpbmRpbmdSZWRpcmVjdCBvbGRWZXJzaW9uPSIxLjAuMC4wLTUuMi4yLjAiIG5ld1ZlcnNpb249IjUuMi4yLjAiIC8+CiAgICAgIDwvZGVwZW5kZW50QXNzZW1ibHk+CiAgICAgIDxkZXBlbmRlbnRBc3NlbWJseT4KICAgICAgICA8YXNzZW1ibHlJZGVudGl0eSBuYW1lPSJTeXN0ZW0uV2ViLk9wdGltaXphdGlvbiIgcHVibGljS2V5VG9rZW49IjMxYmYzODU2YWQzNjRlMzUiIC8+CiAgICAgICAgPGJpbmRpbmdSZWRpcmVjdCBvbGRWZXJzaW9uPSIxLjAuMC4wLTEuMS4wLjAiIG5ld1ZlcnNpb249IjEuMS4wLjAiIC8+CiAgICAgIDwvZGVwZW5kZW50QXNzZW1ibHk+CiAgICAgIDxkZXBlbmRlbnRBc3NlbWJseT4KICAgICAgICA8YXNzZW1ibHlJZGVudGl0eSBuYW1lPSJTeXN0ZW0uV2ViLldlYlBhZ2VzIiBwdWJsaWNLZXlUb2tlbj0iMzFiZjM4NTZhZDM2NGUzNSIgLz4KICAgICAgICA8YmluZGluZ1JlZGlyZWN0IG9sZFZlcnNpb249IjEuMC4wLjAtMy4wLjAuMCIgbmV3VmVyc2lvbj0iMy4wLjAuMCIgLz4KICAgICAgPC9kZXBlbmRlbnRBc3NlbWJseT4KICAgICAgPGRlcGVuZGVudEFzc2VtYmx5PgogICAgICAgIDxhc3NlbWJseUlkZW50aXR5IG5hbWU9IldlYkdyZWFzZSIgcHVibGljS2V5VG9rZW49IjMxYmYzODU2YWQzNjRlMzUiIC8+CiAgICAgICAgPGJpbmRpbmdSZWRpcmVjdCBvbGRWZXJzaW9uPSIwLjAuMC4wLTEuNS4yLjE0MjM0IiBuZXdWZXJzaW9uPSIxLjUuMi4xNDIzNCIgLz4KICAgICAgPC9kZXBlbmRlbnRBc3NlbWJseT4KICAgIDwvYXNzZW1ibHlCaW5kaW5nPgogIDwvcnVudGltZT4KICA8ZW50aXR5RnJhbWV3b3JrPgogICAgPGRlZmF1bHRDb25uZWN0aW9uRmFjdG9yeSB0eXBlPSJTeXN0ZW0uRGF0YS5FbnRpdHkuSW5mcmFzdHJ1Y3R1cmUuTG9jYWxEYkNvbm5lY3Rpb25GYWN0b3J5LCBFbnRpdHlGcmFtZXdvcmsiPgogICAgICA8cGFyYW1ldGVycz4KICAgICAgICA8cGFyYW1ldGVyIHZhbHVlPSJtc3NxbGxvY2FsZGIiIC8+CiAgICAgIDwvcGFyYW1ldGVycz4KICAgIDwvZGVmYXVsdENvbm5lY3Rpb25GYWN0b3J5PgogICAgPHByb3ZpZGVycz4KICAgICAgPHByb3ZpZGVyIGludmFyaWFudE5hbWU9IlN5c3RlbS5EYXRhLlNxbENsaWVudCIgdHlwZT0iU3lzdGVtLkRhdGEuRW50aXR5LlNxbFNlcnZlci5TcWxQcm92aWRlclNlcnZpY2VzLCBFbnRpdHlGcmFtZXdvcmsuU3FsU2VydmVyIiAvPgogICAgPC9wcm92aWRlcnM+CiAgPC9lbnRpdHlGcmFtZXdvcms+CjwvY29uZmlndXJhdGlvbj4=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/App_Start/IdentityConfig.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQp1c2luZyBTeXN0ZW0uRGF0YS5FbnRpdHk7DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DbGFpbXM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHk7DQp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5LkVudGl0eUZyYW1ld29yazsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luOw0KdXNpbmcgTWljcm9zb2Z0Lk93aW4uU2VjdXJpdHk7DQp1c2luZyBBdXRoeTJGQS5Nb2RlbHM7DQp1c2luZyBBdXRoeVByb3ZpZGVyOw0KDQpuYW1lc3BhY2UgQXV0aHkyRkENCnsNCiAgICBwdWJsaWMgY2xhc3MgRW1haWxTZXJ2aWNlIDogSUlkZW50aXR5TWVzc2FnZVNlcnZpY2UNCiAgICB7DQogICAgICAgIHB1YmxpYyBUYXNrIFNlbmRBc3luYyhJZGVudGl0eU1lc3NhZ2UgbWVzc2FnZSkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gUGx1ZyBpbiB5b3VyIGVtYWlsIHNlcnZpY2UgaGVyZSB0byBzZW5kIGFuIGVtYWlsLg0KICAgICAgICAgICAgcmV0dXJuIFRhc2suRnJvbVJlc3VsdCgwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIHB1YmxpYyBjbGFzcyBTbXNTZXJ2aWNlIDogSUlkZW50aXR5TWVzc2FnZVNlcnZpY2UNCiAgICB7DQogICAgICAgIHB1YmxpYyBUYXNrIFNlbmRBc3luYyhJZGVudGl0eU1lc3NhZ2UgbWVzc2FnZSkNCiAgICAgICAgew0KICAgICAgICAgICAgLy8gUGx1ZyBpbiB5b3VyIFNNUyBzZXJ2aWNlIGhlcmUgdG8gc2VuZCBhIHRleHQgbWVzc2FnZS4NCiAgICAgICAgICAgIHJldHVybiBUYXNrLkZyb21SZXN1bHQoMCk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBDb25maWd1cmUgdGhlIGFwcGxpY2F0aW9uIHVzZXIgbWFuYWdlciB1c2VkIGluIHRoaXMgYXBwbGljYXRpb24uIFVzZXJNYW5hZ2VyIGlzIGRlZmluZWQgaW4gQVNQLk5FVCBJZGVudGl0eSBhbmQgaXMgdXNlZCBieSB0aGUgYXBwbGljYXRpb24uDQogICAgcHVibGljIGNsYXNzIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgOiBVc2VyTWFuYWdlcjxBcHBsaWNhdGlvblVzZXI+DQogICAgew0KICAgICAgICBwdWJsaWMgQXBwbGljYXRpb25Vc2VyTWFuYWdlcihJVXNlclN0b3JlPEFwcGxpY2F0aW9uVXNlcj4gc3RvcmUpDQogICAgICAgICAgICA6IGJhc2Uoc3RvcmUpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgQXBwbGljYXRpb25Vc2VyTWFuYWdlciBDcmVhdGUoSWRlbnRpdHlGYWN0b3J5T3B0aW9uczxBcHBsaWNhdGlvblVzZXJNYW5hZ2VyPiBvcHRpb25zLCBJT3dpbkNvbnRleHQgY29udGV4dCkgDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciBtYW5hZ2VyID0gbmV3IEFwcGxpY2F0aW9uVXNlck1hbmFnZXIobmV3IFVzZXJTdG9yZTxBcHBsaWNhdGlvblVzZXI+KGNvbnRleHQuR2V0PEFwcGxpY2F0aW9uRGJDb250ZXh0PigpKSk7DQogICAgICAgICAgICAvLyBDb25maWd1cmUgdmFsaWRhdGlvbiBsb2dpYyBmb3IgdXNlcm5hbWVzDQogICAgICAgICAgICBtYW5hZ2VyLlVzZXJWYWxpZGF0b3IgPSBuZXcgVXNlclZhbGlkYXRvcjxBcHBsaWNhdGlvblVzZXI+KG1hbmFnZXIpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgQWxsb3dPbmx5QWxwaGFudW1lcmljVXNlck5hbWVzID0gZmFsc2UsDQogICAgICAgICAgICAgICAgUmVxdWlyZVVuaXF1ZUVtYWlsID0gdHJ1ZQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgLy8gQ29uZmlndXJlIHZhbGlkYXRpb24gbG9naWMgZm9yIHBhc3N3b3Jkcw0KICAgICAgICAgICAgbWFuYWdlci5QYXNzd29yZFZhbGlkYXRvciA9IG5ldyBQYXNzd29yZFZhbGlkYXRvcg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFJlcXVpcmVkTGVuZ3RoID0gNiwNCiAgICAgICAgICAgICAgICBSZXF1aXJlTm9uTGV0dGVyT3JEaWdpdCA9IHRydWUsDQogICAgICAgICAgICAgICAgUmVxdWlyZURpZ2l0ID0gdHJ1ZSwNCiAgICAgICAgICAgICAgICBSZXF1aXJlTG93ZXJjYXNlID0gdHJ1ZSwNCiAgICAgICAgICAgICAgICBSZXF1aXJlVXBwZXJjYXNlID0gdHJ1ZSwNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB1c2VyIGxvY2tvdXQgZGVmYXVsdHMNCiAgICAgICAgICAgIG1hbmFnZXIuVXNlckxvY2tvdXRFbmFibGVkQnlEZWZhdWx0ID0gdHJ1ZTsNCiAgICAgICAgICAgIG1hbmFnZXIuRGVmYXVsdEFjY291bnRMb2Nrb3V0VGltZVNwYW4gPSBUaW1lU3Bhbi5Gcm9tTWludXRlcyg1KTsNCiAgICAgICAgICAgIG1hbmFnZXIuTWF4RmFpbGVkQWNjZXNzQXR0ZW1wdHNCZWZvcmVMb2Nrb3V0ID0gNTsNCg0KICAgICAgICAgICAgLy8gUmVnaXN0ZXIgdHdvIGZhY3RvciBhdXRoZW50aWNhdGlvbiBwcm92aWRlcnMuIFRoaXMgYXBwbGljYXRpb24gdXNlcyBQaG9uZSBhbmQgRW1haWxzIGFzIGEgc3RlcCBvZiByZWNlaXZpbmcgYSBjb2RlIGZvciB2ZXJpZnlpbmcgdGhlIHVzZXINCiAgICAgICAgICAgIC8vIFlvdSBjYW4gd3JpdGUgeW91ciBvd24gcHJvdmlkZXIgYW5kIHBsdWcgaXQgaW4gaGVyZS4NCiAgICAgICAgICAgIG1hbmFnZXIuUmVnaXN0ZXJUd29GYWN0b3JQcm92aWRlcigiRW1haWwgQ29kZSIsIG5ldyBFbWFpbFRva2VuUHJvdmlkZXI8QXBwbGljYXRpb25Vc2VyPg0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIFN1YmplY3QgPSAiU2VjdXJpdHkgQ29kZSIsDQogICAgICAgICAgICAgICAgQm9keUZvcm1hdCA9ICJZb3VyIHNlY3VyaXR5IGNvZGUgaXMgezB9Ig0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIEF1dGh5IGFzIDJGQSBwcm92aWRlciANCiAgICAgICAgICAgIG1hbmFnZXIuUmVnaXN0ZXJUd29GYWN0b3JQcm92aWRlcigiQXV0aHkgQ29kZSIsIG5ldyBBdXRoeVRva2VuUHJvdmlkZXI8QXBwbGljYXRpb25Vc2VyPigiQXV0aHlJZCIpKTsNCg0KICAgICAgICAgICAgbWFuYWdlci5FbWFpbFNlcnZpY2UgPSBuZXcgRW1haWxTZXJ2aWNlKCk7DQogICAgICAgICAgICBtYW5hZ2VyLlNtc1NlcnZpY2UgPSBuZXcgU21zU2VydmljZSgpOw0KICAgICAgICAgICAgdmFyIGRhdGFQcm90ZWN0aW9uUHJvdmlkZXIgPSBvcHRpb25zLkRhdGFQcm90ZWN0aW9uUHJvdmlkZXI7DQogICAgICAgICAgICBpZiAoZGF0YVByb3RlY3Rpb25Qcm92aWRlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG1hbmFnZXIuVXNlclRva2VuUHJvdmlkZXIgPSANCiAgICAgICAgICAgICAgICAgICAgbmV3IERhdGFQcm90ZWN0b3JUb2tlblByb3ZpZGVyPEFwcGxpY2F0aW9uVXNlcj4oZGF0YVByb3RlY3Rpb25Qcm92aWRlci5DcmVhdGUoIkFTUC5ORVQgSWRlbnRpdHkiKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gbWFuYWdlcjsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gc2lnbi1pbiBtYW5hZ2VyIHdoaWNoIGlzIHVzZWQgaW4gdGhpcyBhcHBsaWNhdGlvbi4NCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIDogU2lnbkluTWFuYWdlcjxBcHBsaWNhdGlvblVzZXIsIHN0cmluZz4NCiAgICB7DQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIoQXBwbGljYXRpb25Vc2VyTWFuYWdlciB1c2VyTWFuYWdlciwgSUF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXIpDQogICAgICAgICAgICA6IGJhc2UodXNlck1hbmFnZXIsIGF1dGhlbnRpY2F0aW9uTWFuYWdlcikNCiAgICAgICAgew0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8Q2xhaW1zSWRlbnRpdHk+IENyZWF0ZVVzZXJJZGVudGl0eUFzeW5jKEFwcGxpY2F0aW9uVXNlciB1c2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdXNlci5HZW5lcmF0ZVVzZXJJZGVudGl0eUFzeW5jKChBcHBsaWNhdGlvblVzZXJNYW5hZ2VyKVVzZXJNYW5hZ2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIENyZWF0ZShJZGVudGl0eUZhY3RvcnlPcHRpb25zPEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcj4gb3B0aW9ucywgSU93aW5Db250ZXh0IGNvbnRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyKGNvbnRleHQuR2V0VXNlck1hbmFnZXI8QXBwbGljYXRpb25Vc2VyTWFuYWdlcj4oKSwgY29udGV4dC5BdXRoZW50aWNhdGlvbik7DQogICAgICAgIH0NCiAgICB9DQp9DQo=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/AuthyProvider/AuthyProvider.cs" data-mode="csharp">77u/dXNpbmcgQXV0aHkuTmV0Ow0KdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsNCnVzaW5nIFN5c3RlbTsNCnVzaW5nIFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljOw0KdXNpbmcgU3lzdGVtLkNvbmZpZ3VyYXRpb247DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5UZXh0Ow0KdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsNCg0KbmFtZXNwYWNlIEF1dGh5UHJvdmlkZXINCnsNCiAgICBwdWJsaWMgY2xhc3MgQXV0aHlUb2tlblByb3ZpZGVyPFRVc2VyPiA6IEF1dGh5VG9rZW5Qcm92aWRlcjxUVXNlciwgc3RyaW5nPiB3aGVyZSBUVXNlciA6IGNsYXNzLCBJVXNlcjxzdHJpbmc+DQogICAgew0KICAgICAgICBwdWJsaWMgQXV0aHlUb2tlblByb3ZpZGVyKHN0cmluZyBhdXRoeUlkUHJvcGVydHlOYW1lKSA6IGJhc2UoYXV0aHlJZFByb3BlcnR5TmFtZSkgeyB9DQogICAgfQ0KDQogICAgcHVibGljIGNsYXNzIEF1dGh5VG9rZW5Qcm92aWRlcjxUVXNlciwgVEtleT4gOiBJVXNlclRva2VuUHJvdmlkZXI8VFVzZXIsIFRLZXk+DQogICAgICAgIHdoZXJlIFRVc2VyIDogY2xhc3MsIElVc2VyPFRLZXk+DQogICAgICAgIHdoZXJlIFRLZXkgOiBJRXF1YXRhYmxlPFRLZXk+DQogICAgew0KICAgICAgICBwcml2YXRlIHN0cmluZyBhdXRoeUtleSA9IENvbmZpZ3VyYXRpb25NYW5hZ2VyLkFwcFNldHRpbmdzWyJBdXRoeUtleSJdOw0KDQogICAgICAgIHB1YmxpYyBBdXRoeVRva2VuUHJvdmlkZXIoc3RyaW5nIGF1dGh5SWRQcm9wZXJ0eU5hbWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHRoaXMuQXV0aHlJZFByb3BlcnR5TmFtZSA9IGF1dGh5SWRQcm9wZXJ0eU5hbWU7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgc3RyaW5nIEF1dGh5SWRQcm9wZXJ0eU5hbWUgeyBnZXQ7IHByaXZhdGUgc2V0OyB9DQoNCiAgICAgICAgcHVibGljIFRhc2s8c3RyaW5nPiBHZW5lcmF0ZUFzeW5jKHN0cmluZyBwdXJwb3NlLCBVc2VyTWFuYWdlcjxUVXNlciwgVEtleT4gbWFuYWdlciwgVFVzZXIgdXNlcikNCiAgICAgICAgew0KICAgICAgICAgICAgLy90aGlzIGNhbiBqdXN0IHJldHVybiBudWxsIGJlY3Vhc2Ugd2UncmUgbm90IGFjdHVhbGx5IGdlbmVyYXRpbmcgdGhlIGNvZGUNCiAgICAgICAgICAgIHJldHVybiBUYXNrLkZyb21SZXN1bHQoKHN0cmluZyludWxsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPGJvb2w+IElzVmFsaWRQcm92aWRlckZvclVzZXJBc3luYyhVc2VyTWFuYWdlcjxUVXNlciwgVEtleT4gbWFuYWdlciwgVFVzZXIgdXNlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG1hbmFnZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKCJtYW5hZ2VyIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBzdHJpbmcgcGhvbmVOdW1iZXIgPSBhd2FpdCBtYW5hZ2VyLkdldFBob25lTnVtYmVyQXN5bmMoKFRLZXkpdXNlci5JZCk7DQogICAgICAgICAgICByZXR1cm4gIXN0cmluZy5Jc051bGxPcldoaXRlU3BhY2UocGhvbmVOdW1iZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIFRhc2sgTm90aWZ5QXN5bmMoc3RyaW5nIHRva2VuLCBVc2VyTWFuYWdlcjxUVXNlciwgVEtleT4gbWFuYWdlciwgVFVzZXIgdXNlcikNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKG1hbmFnZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQXJndW1lbnROdWxsRXhjZXB0aW9uKCJtYW5hZ2VyIik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBjbGllbnQgPSBuZXcgQXV0aHlDbGllbnQoYXV0aHlLZXksIGZhbHNlKTsNCiAgICAgICAgICAgIGNsaWVudC5TZW5kU21zKEZpbmRBdXRoeUlkKHVzZXIpLCB0cnVlKTsNCg0KICAgICAgICAgICAgcmV0dXJuIFRhc2suRnJvbVJlc3VsdCgwKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPGJvb2w+IFZhbGlkYXRlQXN5bmMoc3RyaW5nIHB1cnBvc2UsIHN0cmluZyB0b2tlbiwgVXNlck1hbmFnZXI8VFVzZXIsIFRLZXk+IG1hbmFnZXIsIFRVc2VyIHVzZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICh1c2VyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIGNsaWVudCA9IG5ldyBBdXRoeUNsaWVudChhdXRoeUtleSwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjbGllbnQuVmVyaWZ5VG9rZW4oRmluZEF1dGh5SWQodXNlciksIHRva2VuLCB0cnVlKTsNCg0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3RhdHVzID09IEF1dGh5U3RhdHVzLlN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCg0KICAgICAgICB9DQoNCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgRmluZEF1dGh5SWQoVFVzZXIgdXNlcikNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHVzZXJUeXBlID0gdXNlci5HZXRUeXBlKCk7DQogICAgICAgICAgICB2YXIgYXV0aHlJZFByb3AgPSB1c2VyVHlwZS5HZXRQcm9wZXJ0eSh0aGlzLkF1dGh5SWRQcm9wZXJ0eU5hbWUpOw0KDQogICAgICAgICAgICBpZiAoYXV0aHlJZFByb3AgPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oIkEgcHJvcGVydHkgbmFtZWQgezB9IGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0aGUgdXNlciBtb2RlbCIpOw0KDQogICAgICAgICAgICB2YXIgaWQgPSBhdXRoeUlkUHJvcC5HZXRWYWx1ZSh1c2VyKTsNCg0KICAgICAgICAgICAgcmV0dXJuIChzdHJpbmcpaWQ7DQogICAgICAgIH0NCiAgICB9DQp9</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Controllers/ManageController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIFN5c3RlbS5XZWIuTXZjOw0KdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5Ow0KdXNpbmcgQXV0aHkyRkEuTW9kZWxzOw0KdXNpbmcgQXV0aHkuTmV0Ow0KdXNpbmcgU3lzdGVtLkNvbmZpZ3VyYXRpb247DQoNCm5hbWVzcGFjZSBBdXRoeTJGQS5Db250cm9sbGVycw0Kew0KICAgIFtBdXRob3JpemVdDQogICAgcHVibGljIGNsYXNzIE1hbmFnZUNvbnRyb2xsZXIgOiBDb250cm9sbGVyDQogICAgew0KICAgICAgICBwcml2YXRlIHN0YXRpYyBBdXRoeUNsaWVudCBfYXV0aHlDbGllbnQgPSBuZXcgQXV0aHlDbGllbnQoQ29uZmlndXJhdGlvbk1hbmFnZXIuQXBwU2V0dGluZ3NbIkF1dGh5S2V5Il0pOw0KICAgICAgICBwcml2YXRlIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBfc2lnbkluTWFuYWdlcjsNCiAgICAgICAgcHJpdmF0ZSBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIF91c2VyTWFuYWdlcjsNCg0KICAgICAgICBwdWJsaWMgTWFuYWdlQ29udHJvbGxlcigpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBNYW5hZ2VDb250cm9sbGVyKEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgdXNlck1hbmFnZXIsIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBzaWduSW5NYW5hZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICBVc2VyTWFuYWdlciA9IHVzZXJNYW5hZ2VyOw0KICAgICAgICAgICAgU2lnbkluTWFuYWdlciA9IHNpZ25Jbk1hbmFnZXI7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIFNpZ25Jbk1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9zaWduSW5NYW5hZ2VyID8/IEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuR2V0PEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcj4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHByaXZhdGUgc2V0IA0KICAgICAgICAgICAgeyANCiAgICAgICAgICAgICAgICBfc2lnbkluTWFuYWdlciA9IHZhbHVlOyANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIFVzZXJNYW5hZ2VyDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfdXNlck1hbmFnZXIgPz8gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5HZXRVc2VyTWFuYWdlcjxBcHBsaWNhdGlvblVzZXJNYW5hZ2VyPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHJpdmF0ZSBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdXNlck1hbmFnZXIgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9JbmRleA0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IEluZGV4KE1hbmFnZU1lc3NhZ2VJZD8gbWVzc2FnZSkNCiAgICAgICAgew0KICAgICAgICAgICAgVmlld0JhZy5TdGF0dXNNZXNzYWdlID0NCiAgICAgICAgICAgICAgICBtZXNzYWdlID09IE1hbmFnZU1lc3NhZ2VJZC5DaGFuZ2VQYXNzd29yZFN1Y2Nlc3MgPyAiWW91ciBwYXNzd29yZCBoYXMgYmVlbiBjaGFuZ2VkLiINCiAgICAgICAgICAgICAgICA6IG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLlNldFBhc3N3b3JkU3VjY2VzcyA/ICJZb3VyIHBhc3N3b3JkIGhhcyBiZWVuIHNldC4iDQogICAgICAgICAgICAgICAgOiBtZXNzYWdlID09IE1hbmFnZU1lc3NhZ2VJZC5TZXRUd29GYWN0b3JTdWNjZXNzID8gIllvdXIgdHdvLWZhY3RvciBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBoYXMgYmVlbiBzZXQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgPyAiQW4gZXJyb3IgaGFzIG9jY3VycmVkLiINCiAgICAgICAgICAgICAgICA6IG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLkFkZFBob25lU3VjY2VzcyA/ICJZb3VyIHBob25lIG51bWJlciB3YXMgYWRkZWQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuUmVtb3ZlUGhvbmVTdWNjZXNzID8gIllvdXIgcGhvbmUgbnVtYmVyIHdhcyByZW1vdmVkLiINCiAgICAgICAgICAgICAgICA6ICIiOw0KDQogICAgICAgICAgICB2YXIgdXNlcklkID0gVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKTsNCiAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBJbmRleFZpZXdNb2RlbA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEhhc1Bhc3N3b3JkID0gSGFzUGFzc3dvcmQoKSwNCiAgICAgICAgICAgICAgICBQaG9uZU51bWJlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdldFBob25lTnVtYmVyQXN5bmModXNlcklkKSwNCiAgICAgICAgICAgICAgICBUd29GYWN0b3IgPSBhd2FpdCBVc2VyTWFuYWdlci5HZXRUd29GYWN0b3JFbmFibGVkQXN5bmModXNlcklkKSwNCiAgICAgICAgICAgICAgICBMb2dpbnMgPSBhd2FpdCBVc2VyTWFuYWdlci5HZXRMb2dpbnNBc3luYyh1c2VySWQpLA0KICAgICAgICAgICAgICAgIEJyb3dzZXJSZW1lbWJlcmVkID0gYXdhaXQgQXV0aGVudGljYXRpb25NYW5hZ2VyLlR3b0ZhY3RvckJyb3dzZXJSZW1lbWJlcmVkQXN5bmModXNlcklkKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvUmVtb3ZlTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFJlbW92ZUxvZ2luKHN0cmluZyBsb2dpblByb3ZpZGVyLCBzdHJpbmcgcHJvdmlkZXJLZXkpDQogICAgICAgIHsNCiAgICAgICAgICAgIE1hbmFnZU1lc3NhZ2VJZD8gbWVzc2FnZTsNCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5SZW1vdmVMb2dpbkFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIG5ldyBVc2VyTG9naW5JbmZvKGxvZ2luUHJvdmlkZXIsIHByb3ZpZGVyS2V5KSk7DQogICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeUlkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFNpZ25Jbk1hbmFnZXIuU2lnbkluQXN5bmModXNlciwgaXNQZXJzaXN0ZW50OiBmYWxzZSwgcmVtZW1iZXJCcm93c2VyOiBmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuUmVtb3ZlTG9naW5TdWNjZXNzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3I7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiTWFuYWdlTG9naW5zIiwgbmV3IHsgTWVzc2FnZSA9IG1lc3NhZ2UgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9NYW5hZ2UvQWRkUGhvbmVOdW1iZXINCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBBZGRQaG9uZU51bWJlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0FkZFBob25lTnVtYmVyDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBBZGRQaG9uZU51bWJlcihBZGRQaG9uZU51bWJlclZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeUlkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBfYXV0aHlDbGllbnQuUmVnaXN0ZXJVc2VyKHVzZXIuRW1haWwsIG1vZGVsLk51bWJlciwgaW50LlBhcnNlKG1vZGVsLkNvdW50cnlDb2RlLlJlcGxhY2UoIisiLCAiIikpKTsNCiAgICAgICAgICAgICAgICB1c2VyLkF1dGh5SWQgPSByZXN1bHQuVXNlcklkOw0KICAgICAgICAgICAgICAgIGF3YWl0IFVzZXJNYW5hZ2VyLlVwZGF0ZUFzeW5jKHVzZXIpOw0KDQogICAgICAgICAgICAgICAgX2F1dGh5Q2xpZW50LlNlbmRTbXModXNlci5BdXRoeUlkLCB0cnVlKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIlZlcmlmeVBob25lTnVtYmVyIiwgbmV3IHsgUGhvbmVOdW1iZXIgPSBtb2RlbC5OdW1iZXIgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0VuYWJsZVR3b0ZhY3RvckF1dGhlbnRpY2F0aW9uDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBFbmFibGVUd29GYWN0b3JBdXRoZW50aWNhdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IFVzZXJNYW5hZ2VyLlNldFR3b0ZhY3RvckVuYWJsZWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCB0cnVlKTsNCiAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgIGlmICh1c2VyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsICJNYW5hZ2UiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvRGlzYWJsZVR3b0ZhY3RvckF1dGhlbnRpY2F0aW9uDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBEaXNhYmxlVHdvRmFjdG9yQXV0aGVudGljYXRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBVc2VyTWFuYWdlci5TZXRUd29GYWN0b3JFbmFibGVkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSwgZmFsc2UpOw0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIk1hbmFnZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL1ZlcmlmeVBob25lTnVtYmVyDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gVmVyaWZ5UGhvbmVOdW1iZXIoc3RyaW5nIHBob25lTnVtYmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgY29kZSA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdlbmVyYXRlQ2hhbmdlUGhvbmVOdW1iZXJUb2tlbkFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIHBob25lTnVtYmVyKTsNCiAgICAgICAgICAgIC8vIFNlbmQgYW4gU01TIHRocm91Z2ggdGhlIFNNUyBwcm92aWRlciB0byB2ZXJpZnkgdGhlIHBob25lIG51bWJlcg0KICAgICAgICAgICAgcmV0dXJuIHBob25lTnVtYmVyID09IG51bGwgPyBWaWV3KCJFcnJvciIpIDogVmlldyhuZXcgVmVyaWZ5UGhvbmVOdW1iZXJWaWV3TW9kZWwgeyBQaG9uZU51bWJlciA9IHBob25lTnVtYmVyIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL01hbmFnZS9WZXJpZnlQaG9uZU51bWJlcg0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gVmVyaWZ5UGhvbmVOdW1iZXIoVmVyaWZ5UGhvbmVOdW1iZXJWaWV3TW9kZWwgbW9kZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX2F1dGh5Q2xpZW50LlZlcmlmeVRva2VuKHVzZXIuQXV0aHlJZCwgbW9kZWwuQ29kZSwgdHJ1ZSkuU3RhdHVzID09IEF1dGh5U3RhdHVzLlN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2VyLlBob25lTnVtYmVyID0gbW9kZWwuUGhvbmVOdW1iZXI7DQogICAgICAgICAgICAgICAgICAgIHVzZXIuUGhvbmVOdW1iZXJDb25maXJtZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBVc2VyTWFuYWdlci5VcGRhdGVBc3luYyh1c2VyKTsNCg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuQWRkUGhvbmVTdWNjZXNzIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gSWYgd2UgZ290IHRoaXMgZmFyLCBzb21ldGhpbmcgZmFpbGVkLCByZWRpc3BsYXkgZm9ybQ0KICAgICAgICAgICAgTW9kZWxTdGF0ZS5BZGRNb2RlbEVycm9yKCIiLCAiRmFpbGVkIHRvIHZlcmlmeSBwaG9uZSIpOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL1JlbW92ZVBob25lTnVtYmVyDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gUmVtb3ZlUGhvbmVOdW1iZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuU2V0UGhvbmVOdW1iZXJBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCBudWxsKTsNCiAgICAgICAgICAgIGlmICghcmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCBuZXcgeyBNZXNzYWdlID0gTWFuYWdlTWVzc2FnZUlkLkVycm9yIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgbmV3IHsgTWVzc2FnZSA9IE1hbmFnZU1lc3NhZ2VJZC5SZW1vdmVQaG9uZVN1Y2Nlc3MgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9NYW5hZ2UvQ2hhbmdlUGFzc3dvcmQNCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBDaGFuZ2VQYXNzd29yZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0NoYW5nZVBhc3N3b3JkDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBDaGFuZ2VQYXNzd29yZChDaGFuZ2VQYXNzd29yZFZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNoYW5nZVBhc3N3b3JkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSwgbW9kZWwuT2xkUGFzc3dvcmQsIG1vZGVsLk5ld1Bhc3N3b3JkKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2VlZGVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgbmV3IHsgTWVzc2FnZSA9IE1hbmFnZU1lc3NhZ2VJZC5DaGFuZ2VQYXNzd29yZFN1Y2Nlc3MgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBZGRFcnJvcnMocmVzdWx0KTsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9TZXRQYXNzd29yZA0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IFNldFBhc3N3b3JkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvU2V0UGFzc3dvcmQNCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFNldFBhc3N3b3JkKFNldFBhc3N3b3JkVmlld01vZGVsIG1vZGVsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5BZGRQYXNzd29yZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIG1vZGVsLk5ld1Bhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCBuZXcgeyBNZXNzYWdlID0gTWFuYWdlTWVzc2FnZUlkLlNldFBhc3N3b3JkU3VjY2VzcyB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQWRkRXJyb3JzKHJlc3VsdCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIElmIHdlIGdvdCB0aGlzIGZhciwgc29tZXRoaW5nIGZhaWxlZCwgcmVkaXNwbGF5IGZvcm0NCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9NYW5hZ2VMb2dpbnMNCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBNYW5hZ2VMb2dpbnMoTWFuYWdlTWVzc2FnZUlkPyBtZXNzYWdlKQ0KICAgICAgICB7DQogICAgICAgICAgICBWaWV3QmFnLlN0YXR1c01lc3NhZ2UgPQ0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLlJlbW92ZUxvZ2luU3VjY2VzcyA/ICJUaGUgZXh0ZXJuYWwgbG9naW4gd2FzIHJlbW92ZWQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgPyAiQW4gZXJyb3IgaGFzIG9jY3VycmVkLiINCiAgICAgICAgICAgICAgICA6ICIiOw0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciB1c2VyTG9naW5zID0gYXdhaXQgVXNlck1hbmFnZXIuR2V0TG9naW5zQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICB2YXIgb3RoZXJMb2dpbnMgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIuR2V0RXh0ZXJuYWxBdXRoZW50aWNhdGlvblR5cGVzKCkuV2hlcmUoYXV0aCA9PiB1c2VyTG9naW5zLkFsbCh1bCA9PiBhdXRoLkF1dGhlbnRpY2F0aW9uVHlwZSAhPSB1bC5Mb2dpblByb3ZpZGVyKSkuVG9MaXN0KCk7DQogICAgICAgICAgICBWaWV3QmFnLlNob3dSZW1vdmVCdXR0b24gPSB1c2VyLlBhc3N3b3JkSGFzaCAhPSBudWxsIHx8IHVzZXJMb2dpbnMuQ291bnQgPiAxOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobmV3IE1hbmFnZUxvZ2luc1ZpZXdNb2RlbA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEN1cnJlbnRMb2dpbnMgPSB1c2VyTG9naW5zLA0KICAgICAgICAgICAgICAgIE90aGVyTG9naW5zID0gb3RoZXJMb2dpbnMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL01hbmFnZS9MaW5rTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IExpbmtMb2dpbihzdHJpbmcgcHJvdmlkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3QgYSByZWRpcmVjdCB0byB0aGUgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXIgdG8gbGluayBhIGxvZ2luIGZvciB0aGUgY3VycmVudCB1c2VyDQogICAgICAgICAgICByZXR1cm4gbmV3IEFjY291bnRDb250cm9sbGVyLkNoYWxsZW5nZVJlc3VsdChwcm92aWRlciwgVXJsLkFjdGlvbigiTGlua0xvZ2luQ2FsbGJhY2siLCAiTWFuYWdlIiksIFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL0xpbmtMb2dpbkNhbGxiYWNrDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gTGlua0xvZ2luQ2FsbGJhY2soKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgbG9naW5JbmZvID0gYXdhaXQgQXV0aGVudGljYXRpb25NYW5hZ2VyLkdldEV4dGVybmFsTG9naW5JbmZvQXN5bmMoWHNyZktleSwgVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAobG9naW5JbmZvID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIk1hbmFnZUxvZ2lucyIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuQWRkTG9naW5Bc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCBsb2dpbkluZm8uTG9naW4pOw0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5TdWNjZWVkZWQgPyBSZWRpcmVjdFRvQWN0aW9uKCJNYW5hZ2VMb2dpbnMiKSA6IFJlZGlyZWN0VG9BY3Rpb24oIk1hbmFnZUxvZ2lucyIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBEaXNwb3NlKGJvb2wgZGlzcG9zaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoZGlzcG9zaW5nICYmIF91c2VyTWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF91c2VyTWFuYWdlci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5EaXNwb3NlKGRpc3Bvc2luZyk7DQogICAgICAgIH0NCg0KI3JlZ2lvbiBIZWxwZXJzDQogICAgICAgIC8vIFVzZWQgZm9yIFhTUkYgcHJvdGVjdGlvbiB3aGVuIGFkZGluZyBleHRlcm5hbCBsb2dpbnMNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBzdHJpbmcgWHNyZktleSA9ICJYc3JmSWQiOw0KDQogICAgICAgIHByaXZhdGUgSUF1dGhlbnRpY2F0aW9uTWFuYWdlciBBdXRoZW50aWNhdGlvbk1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuQXV0aGVudGljYXRpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQWRkRXJyb3JzKElkZW50aXR5UmVzdWx0IHJlc3VsdCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAodmFyIGVycm9yIGluIHJlc3VsdC5FcnJvcnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTW9kZWxTdGF0ZS5BZGRNb2RlbEVycm9yKCIiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgSGFzUGFzc3dvcmQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdXNlciA9IFVzZXJNYW5hZ2VyLkZpbmRCeUlkKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdXNlci5QYXNzd29yZEhhc2ggIT0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNQaG9uZU51bWJlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB1c2VyID0gVXNlck1hbmFnZXIuRmluZEJ5SWQoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLlBob25lTnVtYmVyICE9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZW51bSBNYW5hZ2VNZXNzYWdlSWQNCiAgICAgICAgew0KICAgICAgICAgICAgQWRkUGhvbmVTdWNjZXNzLA0KICAgICAgICAgICAgQ2hhbmdlUGFzc3dvcmRTdWNjZXNzLA0KICAgICAgICAgICAgU2V0VHdvRmFjdG9yU3VjY2VzcywNCiAgICAgICAgICAgIFNldFBhc3N3b3JkU3VjY2VzcywNCiAgICAgICAgICAgIFJlbW92ZUxvZ2luU3VjY2VzcywNCiAgICAgICAgICAgIFJlbW92ZVBob25lU3VjY2VzcywNCiAgICAgICAgICAgIEVycm9yDQogICAgICAgIH0NCg0KI2VuZHJlZ2lvbg0KICAgIH0NCn0=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Views/Account/Login.cshtml" data-mode="html">77u/QHVzaW5nIEF1dGh5MkZBLk1vZGVscw0KQG1vZGVsIExvZ2luVmlld01vZGVsDQpAew0KICAgIFZpZXdCYWcuVGl0bGUgPSAiTG9nIGluIjsNCn0NCg0KPGgyPkBWaWV3QmFnLlRpdGxlLjwvaDI+DQo8ZGl2IGNsYXNzPSJyb3ciPg0KICAgIDxkaXYgY2xhc3M9ImNvbC1tZC04Ij4NCiAgICAgICAgPHNlY3Rpb24gaWQ9ImxvZ2luRm9ybSI+DQogICAgICAgICAgICBAdXNpbmcgKEh0bWwuQmVnaW5Gb3JtKCJMb2dpbiIsICJBY2NvdW50IiwgbmV3IHsgUmV0dXJuVXJsID0gVmlld0JhZy5SZXR1cm5VcmwgfSwgRm9ybU1ldGhvZC5Qb3N0LCBuZXcgeyBAY2xhc3MgPSAiZm9ybS1ob3Jpem9udGFsIiwgcm9sZSA9ICJmb3JtIiB9KSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBASHRtbC5BbnRpRm9yZ2VyeVRva2VuKCkNCiAgICAgICAgICAgICAgICA8aDQ+VXNlIGEgbG9jYWwgYWNjb3VudCB0byBsb2cgaW4uPC9oND4NCiAgICAgICAgICAgICAgICA8aHIgLz4NCiAgICAgICAgICAgICAgICBASHRtbC5WYWxpZGF0aW9uU3VtbWFyeSh0cnVlLCAiIiwgbmV3IHsgQGNsYXNzID0gInRleHQtZGFuZ2VyIiB9KQ0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICBASHRtbC5MYWJlbEZvcihtID0+IG0uRW1haWwsIG5ldyB7IEBjbGFzcyA9ICJjb2wtbWQtMiBjb250cm9sLWxhYmVsIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuVGV4dEJveEZvcihtID0+IG0uRW1haWwsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWNvbnRyb2wiIH0pDQogICAgICAgICAgICAgICAgICAgICAgICBASHRtbC5WYWxpZGF0aW9uTWVzc2FnZUZvcihtID0+IG0uRW1haWwsICIiLCBuZXcgeyBAY2xhc3MgPSAidGV4dC1kYW5nZXIiIH0pDQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICBASHRtbC5MYWJlbEZvcihtID0+IG0uUGFzc3dvcmQsIG5ldyB7IEBjbGFzcyA9ICJjb2wtbWQtMiBjb250cm9sLWxhYmVsIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuUGFzc3dvcmRGb3IobSA9PiBtLlBhc3N3b3JkLCBuZXcgeyBAY2xhc3MgPSAiZm9ybS1jb250cm9sIiB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuVmFsaWRhdGlvbk1lc3NhZ2VGb3IobSA9PiBtLlBhc3N3b3JkLCAiIiwgbmV3IHsgQGNsYXNzID0gInRleHQtZGFuZ2VyIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLW9mZnNldC0yIGNvbC1tZC0xMCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGVja2JveCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuQ2hlY2tCb3hGb3IobSA9PiBtLlJlbWVtYmVyTWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuTGFiZWxGb3IobSA9PiBtLlJlbWVtYmVyTWUpDQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC1vZmZzZXQtMiBjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkxvZyBpbiIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIgLz4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPHA+DQogICAgICAgICAgICAgICAgICAgIEBIdG1sLkFjdGlvbkxpbmsoIlJlZ2lzdGVyIGFzIGEgbmV3IHVzZXIiLCAiUmVnaXN0ZXIiKQ0KICAgICAgICAgICAgICAgIDwvcD4NCiAgICAgICAgICAgICAgICBAKiBFbmFibGUgdGhpcyBvbmNlIHlvdSBoYXZlIGFjY291bnQgY29uZmlybWF0aW9uIGVuYWJsZWQgZm9yIHBhc3N3b3JkIHJlc2V0IGZ1bmN0aW9uYWxpdHkNCiAgICAgICAgICAgICAgICAgICAgPHA+DQogICAgICAgICAgICAgICAgICAgICAgICBASHRtbC5BY3Rpb25MaW5rKCJGb3Jnb3QgeW91ciBwYXNzd29yZD8iLCAiRm9yZ290UGFzc3dvcmQiKQ0KICAgICAgICAgICAgICAgICAgICA8L3A+KkANCiAgICAgICAgICAgIH0NCiAgICAgICAgPC9zZWN0aW9uPg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9ImNvbC1tZC00Ij4NCiAgICAgICAgPHNlY3Rpb24gaWQ9InNvY2lhbExvZ2luRm9ybSI+DQogICAgICAgICAgICBASHRtbC5QYXJ0aWFsKCJfRXh0ZXJuYWxMb2dpbnNMaXN0UGFydGlhbCIsIG5ldyBFeHRlcm5hbExvZ2luTGlzdFZpZXdNb2RlbCB7IFJldHVyblVybCA9IFZpZXdCYWcuUmV0dXJuVXJsIH0pDQogICAgICAgIDwvc2VjdGlvbj4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0KDQpAc2VjdGlvbiBTY3JpcHRzIHsNCiAgICBAU2NyaXB0cy5SZW5kZXIoIn4vYnVuZGxlcy9qcXVlcnl2YWwiKQ0KfQ==</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Controllers/AccountController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DbGFpbXM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIFN5c3RlbS5XZWIuTXZjOw0KdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5Ow0KdXNpbmcgQXV0aHkyRkEuTW9kZWxzOw0KDQpuYW1lc3BhY2UgQXV0aHkyRkEuQ29udHJvbGxlcnMNCnsNCiAgICBbQXV0aG9yaXplXQ0KICAgIHB1YmxpYyBjbGFzcyBBY2NvdW50Q29udHJvbGxlciA6IENvbnRyb2xsZXINCiAgICB7DQogICAgICAgIHByaXZhdGUgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIF9zaWduSW5NYW5hZ2VyOw0KICAgICAgICBwcml2YXRlIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgX3VzZXJNYW5hZ2VyOw0KDQogICAgICAgIHB1YmxpYyBBY2NvdW50Q29udHJvbGxlcigpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBY2NvdW50Q29udHJvbGxlcihBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIHVzZXJNYW5hZ2VyLCBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIgc2lnbkluTWFuYWdlciApDQogICAgICAgIHsNCiAgICAgICAgICAgIFVzZXJNYW5hZ2VyID0gdXNlck1hbmFnZXI7DQogICAgICAgICAgICBTaWduSW5NYW5hZ2VyID0gc2lnbkluTWFuYWdlcjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIgU2lnbkluTWFuYWdlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3NpZ25Jbk1hbmFnZXIgPz8gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5HZXQ8QXBwbGljYXRpb25TaWduSW5NYW5hZ2VyPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHJpdmF0ZSBzZXQgDQogICAgICAgICAgICB7IA0KICAgICAgICAgICAgICAgIF9zaWduSW5NYW5hZ2VyID0gdmFsdWU7IA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgVXNlck1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF91c2VyTWFuYWdlciA/PyBIdHRwQ29udGV4dC5HZXRPd2luQ29udGV4dCgpLkdldFVzZXJNYW5hZ2VyPEFwcGxpY2F0aW9uVXNlck1hbmFnZXI+KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcml2YXRlIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF91c2VyTWFuYWdlciA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9Mb2dpbg0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgTG9naW4oc3RyaW5nIHJldHVyblVybCkNCiAgICAgICAgew0KICAgICAgICAgICAgVmlld0JhZy5SZXR1cm5VcmwgPSByZXR1cm5Vcmw7DQogICAgICAgICAgICByZXR1cm4gVmlldygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gTG9naW4oTG9naW5WaWV3TW9kZWwgbW9kZWwsIHN0cmluZyByZXR1cm5VcmwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhpcyBkb2Vzbid0IGNvdW50IGxvZ2luIGZhaWx1cmVzIHRvd2FyZHMgYWNjb3VudCBsb2Nrb3V0DQogICAgICAgICAgICAvLyBUbyBlbmFibGUgcGFzc3dvcmQgZmFpbHVyZXMgdG8gdHJpZ2dlciBhY2NvdW50IGxvY2tvdXQsIGNoYW5nZSB0byBzaG91bGRMb2Nrb3V0OiB0cnVlDQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgU2lnbkluTWFuYWdlci5QYXNzd29yZFNpZ25JbkFzeW5jKG1vZGVsLkVtYWlsLCBtb2RlbC5QYXNzd29yZCwgbW9kZWwuUmVtZW1iZXJNZSwgc2hvdWxkTG9ja291dDogZmFsc2UpOw0KICAgICAgICAgICAgc3dpdGNoIChyZXN1bHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuU3VjY2VzczoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9Mb2NhbChyZXR1cm5VcmwpOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkxvY2tlZE91dDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkxvY2tvdXQiKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5SZXF1aXJlc1ZlcmlmaWNhdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIlNlbmRDb2RlIiwgbmV3IHsgUmV0dXJuVXJsID0gcmV0dXJuVXJsLCBSZW1lbWJlck1lID0gbW9kZWwuUmVtZW1iZXJNZSB9KTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5GYWlsdXJlOg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIE1vZGVsU3RhdGUuQWRkTW9kZWxFcnJvcigiIiwgIkludmFsaWQgbG9naW4gYXR0ZW1wdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9WZXJpZnlDb2RlDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBWZXJpZnlDb2RlKHN0cmluZyBwcm92aWRlciwgc3RyaW5nIHJldHVyblVybCwgYm9vbCByZW1lbWJlck1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBSZXF1aXJlIHRoYXQgdGhlIHVzZXIgaGFzIGFscmVhZHkgbG9nZ2VkIGluIHZpYSB1c2VybmFtZS9wYXNzd29yZCBvciBleHRlcm5hbCBsb2dpbg0KICAgICAgICAgICAgaWYgKCFhd2FpdCBTaWduSW5NYW5hZ2VyLkhhc0JlZW5WZXJpZmllZEFzeW5jKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gVmlldyhuZXcgVmVyaWZ5Q29kZVZpZXdNb2RlbCB7IFByb3ZpZGVyID0gcHJvdmlkZXIsIFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IHJlbWVtYmVyTWUgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9WZXJpZnlDb2RlDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFZlcmlmeUNvZGUoVmVyaWZ5Q29kZVZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGNvZGUgcHJvdGVjdHMgZm9yIGJydXRlIGZvcmNlIGF0dGFja3MgYWdhaW5zdCB0aGUgdHdvIGZhY3RvciBjb2Rlcy4gDQogICAgICAgICAgICAvLyBJZiBhIHVzZXIgZW50ZXJzIGluY29ycmVjdCBjb2RlcyBmb3IgYSBzcGVjaWZpZWQgYW1vdW50IG9mIHRpbWUgdGhlbiB0aGUgdXNlciBhY2NvdW50IA0KICAgICAgICAgICAgLy8gd2lsbCBiZSBsb2NrZWQgb3V0IGZvciBhIHNwZWNpZmllZCBhbW91bnQgb2YgdGltZS4gDQogICAgICAgICAgICAvLyBZb3UgY2FuIGNvbmZpZ3VyZSB0aGUgYWNjb3VudCBsb2Nrb3V0IHNldHRpbmdzIGluIElkZW50aXR5Q29uZmlnDQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgU2lnbkluTWFuYWdlci5Ud29GYWN0b3JTaWduSW5Bc3luYyhtb2RlbC5Qcm92aWRlciwgbW9kZWwuQ29kZSwgaXNQZXJzaXN0ZW50OiAgbW9kZWwuUmVtZW1iZXJNZSwgcmVtZW1iZXJCcm93c2VyOiBtb2RlbC5SZW1lbWJlckJyb3dzZXIpOw0KICAgICAgICAgICAgc3dpdGNoIChyZXN1bHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuU3VjY2VzczoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9Mb2NhbChtb2RlbC5SZXR1cm5VcmwpOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkxvY2tlZE91dDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkxvY2tvdXQiKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5GYWlsdXJlOg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIE1vZGVsU3RhdGUuQWRkTW9kZWxFcnJvcigiIiwgIkludmFsaWQgY29kZS4iKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9SZWdpc3Rlcg0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgUmVnaXN0ZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gVmlldygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvUmVnaXN0ZXINCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gUmVnaXN0ZXIoUmVnaXN0ZXJWaWV3TW9kZWwgbW9kZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdmFyIHVzZXIgPSBuZXcgQXBwbGljYXRpb25Vc2VyIHsgVXNlck5hbWUgPSBtb2RlbC5FbWFpbCwgRW1haWwgPSBtb2RlbC5FbWFpbCB9Ow0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5DcmVhdGVBc3luYyh1c2VyLCBtb2RlbC5QYXNzd29yZCk7DQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZWVkZWQpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDpmYWxzZSwgcmVtZW1iZXJCcm93c2VyOmZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0byBlbmFibGUgYWNjb3VudCBjb25maXJtYXRpb24gYW5kIHBhc3N3b3JkIHJlc2V0IHBsZWFzZSB2aXNpdCBodHRwOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJRD0zMjA3NzENCiAgICAgICAgICAgICAgICAgICAgLy8gU2VuZCBhbiBlbWFpbCB3aXRoIHRoaXMgbGluaw0KICAgICAgICAgICAgICAgICAgICAvLyBzdHJpbmcgY29kZSA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdlbmVyYXRlRW1haWxDb25maXJtYXRpb25Ub2tlbkFzeW5jKHVzZXIuSWQpOw0KICAgICAgICAgICAgICAgICAgICAvLyB2YXIgY2FsbGJhY2tVcmwgPSBVcmwuQWN0aW9uKCJDb25maXJtRW1haWwiLCAiQWNjb3VudCIsIG5ldyB7IHVzZXJJZCA9IHVzZXIuSWQsIGNvZGUgPSBjb2RlIH0sIHByb3RvY29sOiBSZXF1ZXN0LlVybC5TY2hlbWUpOw0KICAgICAgICAgICAgICAgICAgICAvLyBhd2FpdCBVc2VyTWFuYWdlci5TZW5kRW1haWxBc3luYyh1c2VyLklkLCAiQ29uZmlybSB5b3VyIGFjY291bnQiLCAiUGxlYXNlIGNvbmZpcm0geW91ciBhY2NvdW50IGJ5IGNsaWNraW5nIDxhIGhyZWY9XCIiICsgY2FsbGJhY2tVcmwgKyAiXCI+aGVyZTwvYT4iKTsNCg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCAiSG9tZSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBBZGRFcnJvcnMocmVzdWx0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gSWYgd2UgZ290IHRoaXMgZmFyLCBzb21ldGhpbmcgZmFpbGVkLCByZWRpc3BsYXkgZm9ybQ0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9Db25maXJtRW1haWwNCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IENvbmZpcm1FbWFpbChzdHJpbmcgdXNlcklkLCBzdHJpbmcgY29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKHVzZXJJZCA9PSBudWxsIHx8IGNvZGUgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5Db25maXJtRW1haWxBc3luYyh1c2VySWQsIGNvZGUpOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcocmVzdWx0LlN1Y2NlZWRlZCA/ICJDb25maXJtRW1haWwiIDogIkVycm9yIik7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L0ZvcmdvdFBhc3N3b3JkDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBGb3Jnb3RQYXNzd29yZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9Gb3Jnb3RQYXNzd29yZA0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBGb3Jnb3RQYXNzd29yZChGb3Jnb3RQYXNzd29yZFZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKE1vZGVsU3RhdGUuSXNWYWxpZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeU5hbWVBc3luYyhtb2RlbC5FbWFpbCk7DQogICAgICAgICAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCB8fCAhKGF3YWl0IFVzZXJNYW5hZ2VyLklzRW1haWxDb25maXJtZWRBc3luYyh1c2VyLklkKSkpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAvLyBEb24ndCByZXZlYWwgdGhhdCB0aGUgdXNlciBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgY29uZmlybWVkDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJGb3Jnb3RQYXNzd29yZENvbmZpcm1hdGlvbiIpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIGhvdyB0byBlbmFibGUgYWNjb3VudCBjb25maXJtYXRpb24gYW5kIHBhc3N3b3JkIHJlc2V0IHBsZWFzZSB2aXNpdCBodHRwOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJRD0zMjA3NzENCiAgICAgICAgICAgICAgICAvLyBTZW5kIGFuIGVtYWlsIHdpdGggdGhpcyBsaW5rDQogICAgICAgICAgICAgICAgLy8gc3RyaW5nIGNvZGUgPSBhd2FpdCBVc2VyTWFuYWdlci5HZW5lcmF0ZVBhc3N3b3JkUmVzZXRUb2tlbkFzeW5jKHVzZXIuSWQpOw0KICAgICAgICAgICAgICAgIC8vIHZhciBjYWxsYmFja1VybCA9IFVybC5BY3Rpb24oIlJlc2V0UGFzc3dvcmQiLCAiQWNjb3VudCIsIG5ldyB7IHVzZXJJZCA9IHVzZXIuSWQsIGNvZGUgPSBjb2RlIH0sIHByb3RvY29sOiBSZXF1ZXN0LlVybC5TY2hlbWUpOwkJDQogICAgICAgICAgICAgICAgLy8gYXdhaXQgVXNlck1hbmFnZXIuU2VuZEVtYWlsQXN5bmModXNlci5JZCwgIlJlc2V0IFBhc3N3b3JkIiwgIlBsZWFzZSByZXNldCB5b3VyIHBhc3N3b3JkIGJ5IGNsaWNraW5nIDxhIGhyZWY9XCIiICsgY2FsbGJhY2tVcmwgKyAiXCI+aGVyZTwvYT4iKTsNCiAgICAgICAgICAgICAgICAvLyByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiRm9yZ290UGFzc3dvcmRDb25maXJtYXRpb24iLCAiQWNjb3VudCIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJZiB3ZSBnb3QgdGhpcyBmYXIsIHNvbWV0aGluZyBmYWlsZWQsIHJlZGlzcGxheSBmb3JtDQogICAgICAgICAgICByZXR1cm4gVmlldyhtb2RlbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L0ZvcmdvdFBhc3N3b3JkQ29uZmlybWF0aW9uDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBGb3Jnb3RQYXNzd29yZENvbmZpcm1hdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L1Jlc2V0UGFzc3dvcmQNCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IFJlc2V0UGFzc3dvcmQoc3RyaW5nIGNvZGUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBjb2RlID09IG51bGwgPyBWaWV3KCJFcnJvciIpIDogVmlldygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvUmVzZXRQYXNzd29yZA0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBSZXNldFBhc3N3b3JkKFJlc2V0UGFzc3dvcmRWaWV3TW9kZWwgbW9kZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5TmFtZUFzeW5jKG1vZGVsLkVtYWlsKTsNCiAgICAgICAgICAgIGlmICh1c2VyID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgLy8gRG9uJ3QgcmV2ZWFsIHRoYXQgdGhlIHVzZXIgZG9lcyBub3QgZXhpc3QNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiUmVzZXRQYXNzd29yZENvbmZpcm1hdGlvbiIsICJBY2NvdW50Iik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuUmVzZXRQYXNzd29yZEFzeW5jKHVzZXIuSWQsIG1vZGVsLkNvZGUsIG1vZGVsLlBhc3N3b3JkKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2VlZGVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJSZXNldFBhc3N3b3JkQ29uZmlybWF0aW9uIiwgIkFjY291bnQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIEFkZEVycm9ycyhyZXN1bHQpOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvUmVzZXRQYXNzd29yZENvbmZpcm1hdGlvbg0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgUmVzZXRQYXNzd29yZENvbmZpcm1hdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9FeHRlcm5hbExvZ2luDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IEV4dGVybmFsTG9naW4oc3RyaW5nIHByb3ZpZGVyLCBzdHJpbmcgcmV0dXJuVXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBSZXF1ZXN0IGEgcmVkaXJlY3QgdG8gdGhlIGV4dGVybmFsIGxvZ2luIHByb3ZpZGVyDQogICAgICAgICAgICByZXR1cm4gbmV3IENoYWxsZW5nZVJlc3VsdChwcm92aWRlciwgVXJsLkFjdGlvbigiRXh0ZXJuYWxMb2dpbkNhbGxiYWNrIiwgIkFjY291bnQiLCBuZXcgeyBSZXR1cm5VcmwgPSByZXR1cm5VcmwgfSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9TZW5kQ29kZQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gU2VuZENvZGUoc3RyaW5nIHJldHVyblVybCwgYm9vbCByZW1lbWJlck1lKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdXNlcklkID0gYXdhaXQgU2lnbkluTWFuYWdlci5HZXRWZXJpZmllZFVzZXJJZEFzeW5jKCk7DQogICAgICAgICAgICBpZiAodXNlcklkID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgdXNlckZhY3RvcnMgPSBhd2FpdCBVc2VyTWFuYWdlci5HZXRWYWxpZFR3b0ZhY3RvclByb3ZpZGVyc0FzeW5jKHVzZXJJZCk7DQogICAgICAgICAgICB2YXIgZmFjdG9yT3B0aW9ucyA9IHVzZXJGYWN0b3JzLlNlbGVjdChwdXJwb3NlID0+IG5ldyBTZWxlY3RMaXN0SXRlbSB7IFRleHQgPSBwdXJwb3NlLCBWYWx1ZSA9IHB1cnBvc2UgfSkuVG9MaXN0KCk7DQogICAgICAgICAgICByZXR1cm4gVmlldyhuZXcgU2VuZENvZGVWaWV3TW9kZWwgeyBQcm92aWRlcnMgPSBmYWN0b3JPcHRpb25zLCBSZXR1cm5VcmwgPSByZXR1cm5VcmwsIFJlbWVtYmVyTWUgPSByZW1lbWJlck1lIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvU2VuZENvZGUNCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gU2VuZENvZGUoU2VuZENvZGVWaWV3TW9kZWwgbW9kZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSB0b2tlbiBhbmQgc2VuZCBpdA0KICAgICAgICAgICAgaWYgKCFhd2FpdCBTaWduSW5NYW5hZ2VyLlNlbmRUd29GYWN0b3JDb2RlQXN5bmMobW9kZWwuU2VsZWN0ZWRQcm92aWRlcikpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiVmVyaWZ5Q29kZSIsIG5ldyB7IFByb3ZpZGVyID0gbW9kZWwuU2VsZWN0ZWRQcm92aWRlciwgUmV0dXJuVXJsID0gbW9kZWwuUmV0dXJuVXJsLCBSZW1lbWJlck1lID0gbW9kZWwuUmVtZW1iZXJNZSB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRXh0ZXJuYWxMb2dpbkNhbGxiYWNrDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBFeHRlcm5hbExvZ2luQ2FsbGJhY2soc3RyaW5nIHJldHVyblVybCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGxvZ2luSW5mbyA9IGF3YWl0IEF1dGhlbnRpY2F0aW9uTWFuYWdlci5HZXRFeHRlcm5hbExvZ2luSW5mb0FzeW5jKCk7DQogICAgICAgICAgICBpZiAobG9naW5JbmZvID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkxvZ2luIik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFNpZ24gaW4gdGhlIHVzZXIgd2l0aCB0aGlzIGV4dGVybmFsIGxvZ2luIHByb3ZpZGVyIGlmIHRoZSB1c2VyIGFscmVhZHkgaGFzIGEgbG9naW4NCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBTaWduSW5NYW5hZ2VyLkV4dGVybmFsU2lnbkluQXN5bmMobG9naW5JbmZvLCBpc1BlcnNpc3RlbnQ6IGZhbHNlKTsNCiAgICAgICAgICAgIHN3aXRjaCAocmVzdWx0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLlN1Y2Nlc3M6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvTG9jYWwocmV0dXJuVXJsKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5Mb2NrZWRPdXQ6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJMb2Nrb3V0Iik7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuUmVxdWlyZXNWZXJpZmljYXRpb246DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJTZW5kQ29kZSIsIG5ldyB7IFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IGZhbHNlIH0pOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkZhaWx1cmU6DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgZG9lcyBub3QgaGF2ZSBhbiBhY2NvdW50LCB0aGVuIHByb21wdCB0aGUgdXNlciB0byBjcmVhdGUgYW4gYWNjb3VudA0KICAgICAgICAgICAgICAgICAgICBWaWV3QmFnLlJldHVyblVybCA9IHJldHVyblVybDsNCiAgICAgICAgICAgICAgICAgICAgVmlld0JhZy5Mb2dpblByb3ZpZGVyID0gbG9naW5JbmZvLkxvZ2luLkxvZ2luUHJvdmlkZXI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJFeHRlcm5hbExvZ2luQ29uZmlybWF0aW9uIiwgbmV3IEV4dGVybmFsTG9naW5Db25maXJtYXRpb25WaWV3TW9kZWwgeyBFbWFpbCA9IGxvZ2luSW5mby5FbWFpbCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9BY2NvdW50L0V4dGVybmFsTG9naW5Db25maXJtYXRpb24NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gRXh0ZXJuYWxMb2dpbkNvbmZpcm1hdGlvbihFeHRlcm5hbExvZ2luQ29uZmlybWF0aW9uVmlld01vZGVsIG1vZGVsLCBzdHJpbmcgcmV0dXJuVXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoVXNlci5JZGVudGl0eS5Jc0F1dGhlbnRpY2F0ZWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIk1hbmFnZSIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgZnJvbSB0aGUgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXINCiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGF3YWl0IEF1dGhlbnRpY2F0aW9uTWFuYWdlci5HZXRFeHRlcm5hbExvZ2luSW5mb0FzeW5jKCk7DQogICAgICAgICAgICAgICAgaWYgKGluZm8gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJFeHRlcm5hbExvZ2luRmFpbHVyZSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG5ldyBBcHBsaWNhdGlvblVzZXIgeyBVc2VyTmFtZSA9IG1vZGVsLkVtYWlsLCBFbWFpbCA9IG1vZGVsLkVtYWlsIH07DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNyZWF0ZUFzeW5jKHVzZXIpOw0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2VlZGVkKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuQWRkTG9naW5Bc3luYyh1c2VyLklkLCBpbmZvLkxvZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZWVkZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFNpZ25Jbk1hbmFnZXIuU2lnbkluQXN5bmModXNlciwgaXNQZXJzaXN0ZW50OiBmYWxzZSwgcmVtZW1iZXJCcm93c2VyOiBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0xvY2FsKHJldHVyblVybCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQWRkRXJyb3JzKHJlc3VsdCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFZpZXdCYWcuUmV0dXJuVXJsID0gcmV0dXJuVXJsOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvTG9nT2ZmDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBMb2dPZmYoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIuU2lnbk91dCgpOw0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIkhvbWUiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRXh0ZXJuYWxMb2dpbkZhaWx1cmUNCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IEV4dGVybmFsTG9naW5GYWlsdXJlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIERpc3Bvc2UoYm9vbCBkaXNwb3NpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChkaXNwb3NpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF91c2VyTWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoX3NpZ25Jbk1hbmFnZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9zaWduSW5NYW5hZ2VyLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgX3NpZ25Jbk1hbmFnZXIgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5EaXNwb3NlKGRpc3Bvc2luZyk7DQogICAgICAgIH0NCg0KICAgICAgICAjcmVnaW9uIEhlbHBlcnMNCiAgICAgICAgLy8gVXNlZCBmb3IgWFNSRiBwcm90ZWN0aW9uIHdoZW4gYWRkaW5nIGV4dGVybmFsIGxvZ2lucw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBYc3JmS2V5ID0gIlhzcmZJZCI7DQoNCiAgICAgICAgcHJpdmF0ZSBJQXV0aGVudGljYXRpb25NYW5hZ2VyIEF1dGhlbnRpY2F0aW9uTWFuYWdlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5BdXRoZW50aWNhdGlvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBBZGRFcnJvcnMoSWRlbnRpdHlSZXN1bHQgcmVzdWx0KQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3JlYWNoICh2YXIgZXJyb3IgaW4gcmVzdWx0LkVycm9ycykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBNb2RlbFN0YXRlLkFkZE1vZGVsRXJyb3IoIiIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgQWN0aW9uUmVzdWx0IFJlZGlyZWN0VG9Mb2NhbChzdHJpbmcgcmV0dXJuVXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoVXJsLklzTG9jYWxVcmwocmV0dXJuVXJsKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3QocmV0dXJuVXJsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsICJIb21lIik7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBjbGFzcyBDaGFsbGVuZ2VSZXN1bHQgOiBIdHRwVW5hdXRob3JpemVkUmVzdWx0DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBDaGFsbGVuZ2VSZXN1bHQoc3RyaW5nIHByb3ZpZGVyLCBzdHJpbmcgcmVkaXJlY3RVcmkpDQogICAgICAgICAgICAgICAgOiB0aGlzKHByb3ZpZGVyLCByZWRpcmVjdFVyaSwgbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIENoYWxsZW5nZVJlc3VsdChzdHJpbmcgcHJvdmlkZXIsIHN0cmluZyByZWRpcmVjdFVyaSwgc3RyaW5nIHVzZXJJZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2dpblByb3ZpZGVyID0gcHJvdmlkZXI7DQogICAgICAgICAgICAgICAgUmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaTsNCiAgICAgICAgICAgICAgICBVc2VySWQgPSB1c2VySWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgTG9naW5Qcm92aWRlciB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIFJlZGlyZWN0VXJpIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgVXNlcklkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRXhlY3V0ZVJlc3VsdChDb250cm9sbGVyQ29udGV4dCBjb250ZXh0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gbmV3IEF1dGhlbnRpY2F0aW9uUHJvcGVydGllcyB7IFJlZGlyZWN0VXJpID0gUmVkaXJlY3RVcmkgfTsNCiAgICAgICAgICAgICAgICBpZiAoVXNlcklkICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLkRpY3Rpb25hcnlbWHNyZktleV0gPSBVc2VySWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5BdXRoZW50aWNhdGlvbi5DaGFsbGVuZ2UocHJvcGVydGllcywgTG9naW5Qcm92aWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgI2VuZHJlZ2lvbg0KICAgIH0NCn0=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Views/Account/VerifyCode.cshtml" data-mode="html">77u/QG1vZGVsIEF1dGh5MkZBLk1vZGVscy5WZXJpZnlDb2RlVmlld01vZGVsDQpAew0KICAgIFZpZXdCYWcuVGl0bGUgPSAiVmVyaWZ5IjsNCn0NCg0KPGgyPkBWaWV3QmFnLlRpdGxlLjwvaDI+DQoNCkB1c2luZyAoSHRtbC5CZWdpbkZvcm0oIlZlcmlmeUNvZGUiLCAiQWNjb3VudCIsIG5ldyB7IFJldHVyblVybCA9IE1vZGVsLlJldHVyblVybCB9LCBGb3JtTWV0aG9kLlBvc3QsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWhvcml6b250YWwiLCByb2xlID0gImZvcm0iIH0pKSB7DQogICAgQEh0bWwuQW50aUZvcmdlcnlUb2tlbigpDQogICAgQEh0bWwuSGlkZGVuKCJwcm92aWRlciIsIEBNb2RlbC5Qcm92aWRlcikNCiAgICBASHRtbC5IaWRkZW4oInJlbWVtYmVyTWUiLCBATW9kZWwuUmVtZW1iZXJNZSkNCiAgICA8aDQ+RW50ZXIgdmVyaWZpY2F0aW9uIGNvZGU8L2g0Pg0KICAgIDxociAvPg0KICAgIEBIdG1sLlZhbGlkYXRpb25TdW1tYXJ5KCIiLCBuZXcgeyBAY2xhc3MgPSAidGV4dC1kYW5nZXIiIH0pDQogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgIEBIdG1sLkxhYmVsRm9yKG0gPT4gbS5Db2RlLCBuZXcgeyBAY2xhc3MgPSAiY29sLW1kLTIgY29udHJvbC1sYWJlbCIgfSkNCiAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTEwIj4NCiAgICAgICAgICAgIEBIdG1sLlRleHRCb3hGb3IobSA9PiBtLkNvZGUsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWNvbnRyb2wiIH0pDQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtb2Zmc2V0LTIgY29sLW1kLTEwIj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoZWNrYm94Ij4NCiAgICAgICAgICAgICAgICBASHRtbC5DaGVja0JveEZvcihtID0+IG0uUmVtZW1iZXJCcm93c2VyKQ0KICAgICAgICAgICAgICAgIEBIdG1sLkxhYmVsRm9yKG0gPT4gbS5SZW1lbWJlckJyb3dzZXIpDQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC1vZmZzZXQtMiBjb2wtbWQtMTAiPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIgdmFsdWU9IlN1Ym1pdCIgLz4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQp9DQoNCkBzZWN0aW9uIFNjcmlwdHMgew0KICAgIEBTY3JpcHRzLlJlbmRlcigifi9idW5kbGVzL2pxdWVyeXZhbCIpDQp9DQo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>