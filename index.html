<!DOCTYPE html><html><head><title>Two-Factor Authentication with Authy</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Two-Factor Authentication with Authy"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Two-Factor Authentication with Authy</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Learn to implement two-factor authentication (2FA) in your web app with Twilio-powered Authy. 2FA helps further secure your users' data by validating more than just a password. This tutorial will show you the code to make it happen.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Application Setup" class="chapter"><div data-title="How it Works" data-file="Authy2FA/Providers/AuthyOneTouchProvider.cs" data-highlight="44-56" class="step"><h2 id="about-this-application">About this application</h2>
<p>This <a href="//www.asp.net/mvc">ASP.NET MVC</a> sample application is an
example of typical login flow. To run this sample app yourself, <a href="https://github.com/TwilioDevEd/authy2fa-csharp">download
the code and follow the instructions on
GitHub</a>.</p>
<p>Adding two-factor authentication (2FA) to your web application increases the 
security of your user&#39;s data. <a href="http://en.wikipedia.org/wiki/Multi-factor_authentication">Multi-factor authentication</a> 
determines the identity of a user by validating once by logging into the app, 
and second by validating their mobile device.</p>
<p>For the second factor, we will validate that the user has their mobile phone by either:</p>
<ul>
<li>Sending them a OneTouch push notification to their mobile Authy app or</li>
<li>Sending them a token through their mobile Authy app or</li>
<li>Sending them a one-time token in a text message <a href="http://www.authy.com/">sent with Authy via
Twilio</a>. Here&#39;s how this works at a high level:</li>
</ul>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-high-level.png" alt="2FA High Level"></p>
<p>Let&#39;s get started! Click the right arrow above to move to the next step
  of the tutorial.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.asp.net/mvc/overview/getting-started/introduction/getting-started">Getting Started with ASP.NET MVC 5</a></li>
<li><a href="//www.nuget.org/packages/Authy.Net/">Authy.Net Nuget Package</a></li>
</ul>
</div><div data-title="Configuring Authy" data-file="Authy2FA/App_Start/IdentityConfig.cs" data-highlight="77-79" class="step"><h2 id="configuring-authy">Configuring Authy</h2>
<p>If you haven&#39;t already, now is the time to <a href="https://dashboard.authy.com/signup">sign up for Authy</a>. 
Create your first application, naming it whatever you wish. After you create your application, 
your &quot;production&quot; API key will be visible on your <a href="https://dashboard.authy.com">dashboard</a>:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-authy-dashboard.png" alt="Authy Dashboard"></p>
<p>Once we have an Authy API key, we store it in the <code>Web.config</code> file.</p>
<p>We also need to register the Authy as a 2FA provider on <code>IdentityConfig</code>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.asp.net/identity">Getting Started with Identity</a></li>
<li><a href="//github.com/authy/authy.net/">Authy .NET</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/610xe886.aspx">How to: Read Application Settings from the Web.config File</a></li>
</ul>
</div></div><div data-title="Configuring ASP.NET Identity System" class="chapter"><div data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="112-134" class="step"><h2 id="registering-a-user-with-authy">Registering a User with Authy</h2>
<p>When a new User signs up for our website, we call this controller, which
handles saving our new User to the database as well as registering the User
with Authy.</p>
<p>All Authy needs to get a user set up for your application is the email,
phone number and country code. In order to do two-factor authentication,
we need to make sure we ask for these things at the point of sign up.</p>
<p>Once we register the User with Authy we get an <code>AuthyId</code> back. This is
very important since it&#39;s how we will verify the identity of our User with
Authy.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity">Introduction to ASP.NET Identity</a></li>
<li><a href="//docs.authy.com/#section-Enabling_two-factor_on_a_user">Enabling a User with Authy</a></li>
</ul>
</div><div data-file="Authy2FA/Providers/AuthyOneTouchProvider.cs" data-highlight="44-56" class="step"><h2 id="logging-in-with-authy-onetouch">Logging in with Authy OneTouch</h2>
<p>When a User attempts to log in to our website, we will ask them for a second 
form of identification. Let&#39;s take a look at OneTouch verification first. </p>
<p><img src="//howtodocs.s3.amazonaws.com/onetouch-approved.gif" alt="Authy OneTouch Approval"></p>
<p>OneTouch works like so:</p>
<ul>
<li>We attempt to send a User a <em>OneTouch Approval Request</em></li>
<li>If the User has OneTouch enabled, we will get a <code>success</code> message back</li>
<li>The User hits &#39;approve&#39; in their Authy app</li>
<li>Authy makes a POST request to our app with an &#39;approved&#39; status</li>
<li>We log the User in</li>
</ul>
<p>In the next steps we&#39;ll look at how we handle cases where the User does not
have OneTouch, or denies the login request.</p>
</div><div data-file="Authy2FA/Providers/AuthyOneTouchProvider.cs" data-highlight="44-56" class="step"><h2 id="sending-the-onetouch-request">Sending the OneTouch Request</h2>
<p>When our User logs in we let the user decide which two-factor authentication
provider will used, it can be either <em>Authy One Touch</em> or <em>Authy Token</em>.
Authy OneTouch should be used when the user have a registered OneTouch
device.</p>
<p>Authy lets us pass details with our OneTouch request, including a message,
a logo and any other details we want to send. We could easily send any
number of details by appending <code>details[&#39;some_detail&#39;]</code>. You could imagine a
scenario where we send a OneTouch request to approve a money transfer:</p>
<pre><code class="cm-s-monokai lang-javascript"><span class="cm-keyword">var</span> <span class="cm-variable">request</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">NameValueCollection</span>
{
  {<span class="cm-string">&quot;message&quot;</span>, <span class="cm-string">&quot;Request to Send Money to Jarod&#39;s vault&quot;</span>},
  {<span class="cm-string">&quot;details[&#39;Request From&#39;]&quot;</span>, <span class="cm-string">&quot;Jarod&quot;</span>},
  {<span class="cm-string">&quot;details[&#39;Amount Request&#39;]&quot;</span>, <span class="cm-string">&quot;1,000,000&quot;</span>},
  {<span class="cm-string">&quot;details[&#39;Currency&#39;]&quot;</span>, <span class="cm-string">&quot;Galleons&quot;</span>}
};
</code></pre>
<p>Once we send the request we need to update our User&#39;s <code>AuthyStatus</code> based
on the response.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection.aspx">NameValueCollection Class</a></li>
</ul>
</div><div data-file="Authy2FA/Controllers/AuthyController.cs" data-highlight="32-47, 73-77" class="step"><h2 id="configuring-the-onetouch-callback">Configuring the OneTouch callback</h2>
<p>In order for our app to know what the User did after we sent the OneTouch
request, we need to register a callback endpoint with Authy.</p>
<p><img src="//howtodocs.s3.amazonaws.com/onetouch-callback-endpoint.png" alt="Authy OneTouch Callback"></p>
<p>*Note: In order to verify that the request is coming from Authy we&#39;ve
written a helper method that will halt the request if it appears it isn&#39;t coming
from Authy.</p>
<p>Here in our callback, we look up the user using the <code>authy_id</code> sent with the
Authy POST request. Ideally at this point we would probably use a websocket
to let our client know that we received a response from Authy. However for
this version we&#39;re going to keep it simple and just update the
<code>AuthyStatus</code> on the User. Then all our client-side code needs to do is
check for <code>user.AuthyStatus == &quot;approved&quot;</code> before logging her in.</p>
<p>Let&#39;s take a look at the client-side code that will be handling this.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/library/dn613290.aspx">UserManager&lt;TUser, TKey&gt; Class</a></li>
</ul>
</div><div data-file="Authy2FA/Scripts/onetouch.js" class="step"><h2 id="handling-two-factor-asyncronously">Handling Two-Factor Asyncronously</h2>
<p>We&#39;ve already taken a look at what&#39;s happening on the server side, so let&#39;s
step in front of the cameras now and see how our JavaScript is interacting
with those server endpoints.</p>
<p>When we expect a OneTouch response, we will begin polling
<code>/Authy/OneTouchStatus</code> until we either see OneTouch login was either
approved or denied. Let&#39;s take a  look at this controller and see what is
happening.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//api.jquery.com/jquery.post/">jQuery Post method</a></li>
<li><a href="//api.jquery.com/submit/">jQuery submit()</a></li>
</ul>
</div><div data-file="Authy2FA/Controllers/AuthyController.cs" data-highlight="49-71" class="step"><h2 id="is-approved-or-denied">Is Approved or Denied</h2>
<p>Here is the endpoint that our javascript is polling. It is waiting for the
user status to be either <strong>approved</strong> or <strong>denied</strong>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//msdn.microsoft.com/en-us/library/mt173765.aspx">SignInManager&lt;TUser, TKey&gt;.GetVerifiedUserIdAsync Method ()</a></li>
<li><a href="https://msdn.microsoft.com/en-us/library/dn497542.aspx">UserManager&lt;TUser, TKey&gt;.FindByIdAsync Method</a></li>
</ul>
</div><div data-file="Authy2FA/Controllers/AccountController.cs" data-highlight="150-172" class="step"><h2 id="when-we-have-an-authystatus">When we have an AuthyStatus</h2>
<p>If the <code>AuthyStatus</code> is approved, then the user will be redirected to the
home page, otherwise we&#39;ll show the <code>/Account/Login</code> form.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://msdn.microsoft.com/en-us/library/mt173758.aspx">SignInManager&lt;TUser, TKey&gt;.TwoFactorSignInAsync Method</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to next?</h2>
<p>That&#39;s it! We&#39;ve just implemented two-factor auth using three different
methods and the latest in Authy technology.</p>
<p>If you&#39;re a C# developer working with Twilio, you might enjoy these
other tutorials:</p>
<p><a href="https://www.twilio.com/docs/howto/walkthrough/ivr-phone-tree/csharp/mvc"><strong>IVR: Phone Tree</strong></a></p>
<p>Easily route callers to the right people and information with an IVR
(interactive voice response) system</p>
<p><a href="//www.twilio.com/docs/howto/walkthrough/call-tracking/csharp/mvc"><strong>Call Tracking</strong></a></p>
<p>Use Twilio to track the effectiveness of your marketing campaigns.</p>
<h3 id="did-this-help-">Did this help?</h3>
<p>Thanks for checking out this tutorial! If you have any feedback to share
with us, we&#39;d love to hear it. Tweet
<a href="http://twitter.com/twilio">@twilio</a> to let us know what you think.</p>
</div></div><div data-title="Implementing the Login Flow" class="chapter"><div data-title="Implementing the Login Flow" data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="" class="step"><h2 id="implementing-the-login-flow">Implementing the Login Flow</h2>
<p>When you generate a new project for ASP.NET MVC, a lot of the front-end code and controller logic is generated for you. The project combines jQuery, <a href="http://getbootstrap.com/">Bootstrap</a>, and <a href="http://modernizr.com/">Modernizr</a> along with C# code at the controller level to create a fully baked user management system.</p>
<p>At a high level, our 2FA login flow will look like this:</p>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow.png" alt="2FA Flow Chart"></p>
<p>Let&#39;s step through this login flow to see what&#39;s happening at each step.</p>
</div><div data-title="The Login Form" data-file="Authy2FA/Views/Account/Login.cshtml" data-highlight="17-30" data-mode="html" class="step"><h2 id="the-login-form">The Login Form</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow2.png" alt="2FA Flow Chart Step 2"></p>
<p>On this login form, the user will attempt to validate the first &quot;factor&quot; of their identity, which is a password they already know. The user will enter their e-mail address and password in this form, and will send it to our server for validation.</p>
<p>Let&#39;s check out the code that handles this form submission next.</p>
</div><div data-title="Validating the E-Mail and Password" data-file="Authy2FA/Controllers/AccountController.cs" data-highlight="66-92" class="step"><h2 id="validating-the-e-mail-and-password">Validating the E-Mail and Password</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow3.png" alt="2FA Flow Chart Step 3"></p>
<p>On the server, we receive the e-mail address and password the user entered on the <a href="http://blogs.msdn.com/b/rickandy/archive/2011/01/28/dynamic-v-strongly-typed-views.aspx">view model</a> and asynchronoously check to see if they are valid.  If the e-mail and password combination match (and the user has two-factor authentication enabled), we will receive a <code>SignInStatus.RequiresVerification</code> result.  From there, we redirect to the <code>SendCode</code> action in this same controller.</p>
<p>This will display a form that will allow the user to select a 2FA provider from a drop-down list. In this example, Authy is the only choice. When the user submits this form, our <code>AuthyTokenProvider</code> class will take over and send the verification code via SMS.</p>
</div><div data-title="Entering the Verification Code" data-file="Authy2FA/Views/Account/VerifyCode.cshtml" data-highlight="15-20" data-mode="html" class="step"><h2 id="entering-the-verification-code">Entering the Verification Code</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow7.png" alt="2FA Flow Chart Step 7"></p>
<p>Once the code is sent, we display a form for the user to enter the one-time password that was sent to them via SMS.</p>
</div><div data-title="Validating the Code" data-file="Authy2FA/Controllers/AccountController.cs" data-highlight="109-135" class="step"><h2 id="validating-the-code">Validating the Code</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow8.png" alt="2FA Flow Chart Step 8"></p>
<p>On the server, we use the <code>SignInManager</code> once again to validate the 2FA code that was entered by the user on the form. This will, eventually, use the <code>ValidateAsync</code> method on our <code>AuthyTokenProvider</code> class we saw earlier.  If the code is valid, we&#39;re all set with an authenticated session!</p>
</div><div data-title="Accessing Protected Resources" data-file="Authy2FA/Controllers/ManageController.cs" data-highlight="13-16" class="step"><h2 id="accessing-protected-resources">Accessing Protected Resources</h2>
<p><img src="//s3.amazonaws.com/howtodocs/2fa-flow10.png" alt="2FA Flow Chart Step 10"></p>
<p>Now that we have an authenticated session, we can annotate other controllers in our application with <code>[Authorize]</code> to make sure an authenticated user only is allowed to see these items. Identity / Entity Framework also have finer-grained access controls you can use as well.</p>
</div><div data-title="All Done!" data-file="Authy2FA/Controllers/ManageController.cs" class="step"><h2 id="all-done-">All Done!</h2>
<p>And with just a bit of code to integrate Authy, our ASP.NET MVC application can now take advantage of high-level features Authy provides like a native 2FA app, user management and health checking, and much more.</p>
<p>We hope you found this tutorial useful - if you have any questions or feedback, please let us know! Hit us up <a href="http://twitter.com/twilio">on Twitter</a> or send a note to <a href="mailto:help@twilio.com">help@twilio.com</a>. We&#39;d love to hear from you.</p>
</div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="Authy2FA/Providers/AuthyOneTouchProvider.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29uZmlndXJhdGlvbjsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgQXV0aHkuTmV0Owp1c2luZyBBdXRoeTJGQS5Eb21haW4uQXV0aHk7CnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHk7CgpuYW1lc3BhY2UgQXV0aHkyRkEuUHJvdmlkZXJzCnsKICAgIHB1YmxpYyBjbGFzcyBBdXRoeU9uZVRvdWNoUHJvdmlkZXI8VFVzZXI+IDogQXV0aHlPbmVUb3VjaFByb3ZpZGVyPFRVc2VyLCBzdHJpbmc+IHdoZXJlIFRVc2VyIDogY2xhc3MsIElVc2VyPHN0cmluZz4KICAgIHsKICAgICAgICBwdWJsaWMgQXV0aHlPbmVUb3VjaFByb3ZpZGVyKHN0cmluZyBhdXRoeUlkUHJvcGVydHlOYW1lKSA6IGJhc2UoYXV0aHlJZFByb3BlcnR5TmFtZSkgeyB9CiAgICB9CgogICAgcHVibGljIGNsYXNzIEF1dGh5T25lVG91Y2hQcm92aWRlcjxUVXNlciwgVEtleT4gOiBJVXNlclRva2VuUHJvdmlkZXI8VFVzZXIsIFRLZXk+CiAgICAgICAgd2hlcmUgVFVzZXIgOiBjbGFzcywgSVVzZXI8VEtleT4KICAgICAgICB3aGVyZSBUS2V5IDogSUVxdWF0YWJsZTxUS2V5PgogICAgewogICAgICAgIHByaXZhdGUgcmVhZG9ubHkgc3RyaW5nIF9hdXRoeUtleSA9IENvbmZpZ3VyYXRpb25NYW5hZ2VyLkFwcFNldHRpbmdzWyJBdXRoeUtleSJdOwoKICAgICAgICBwdWJsaWMgQXV0aHlPbmVUb3VjaFByb3ZpZGVyKHN0cmluZyBhdXRoeUlkUHJvcGVydHlOYW1lKQogICAgICAgIHsKICAgICAgICAgICAgdGhpcy5BdXRoeUlkUHJvcGVydHlOYW1lID0gYXV0aHlJZFByb3BlcnR5TmFtZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdHJpbmcgQXV0aHlJZFByb3BlcnR5TmFtZSB7IGdldDsgcHJpdmF0ZSBzZXQ7IH0KCiAgICAgICAgcHVibGljIFRhc2s8c3RyaW5nPiBHZW5lcmF0ZUFzeW5jKHN0cmluZyBwdXJwb3NlLCBVc2VyTWFuYWdlcjxUVXNlciwgVEtleT4gbWFuYWdlciwgVFVzZXIgdXNlcikKICAgICAgICB7CiAgICAgICAgICAgIC8vdGhpcyBjYW4ganVzdCByZXR1cm4gbnVsbCBiZWN1YXNlIHdlJ3JlIG5vdCBhY3R1YWxseSBnZW5lcmF0aW5nIHRoZSBjb2RlCiAgICAgICAgICAgIHJldHVybiBUYXNrLkZyb21SZXN1bHQoKHN0cmluZyludWxsKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPGJvb2w+IElzVmFsaWRQcm92aWRlckZvclVzZXJBc3luYyhVc2VyTWFuYWdlcjxUVXNlciwgVEtleT4gbWFuYWdlciwgVFVzZXIgdXNlcikKICAgICAgICB7CiAgICAgICAgICAgIGlmIChtYW5hZ2VyID09IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBBcmd1bWVudE51bGxFeGNlcHRpb24oIm1hbmFnZXIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcGhvbmVOdW1iZXIgPSBhd2FpdCBtYW5hZ2VyLkdldFBob25lTnVtYmVyQXN5bmModXNlci5JZCk7CiAgICAgICAgICAgIHJldHVybiAhc3RyaW5nLklzTnVsbE9yV2hpdGVTcGFjZShwaG9uZU51bWJlcik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgVGFzayBOb3RpZnlBc3luYyhzdHJpbmcgdG9rZW4sIFVzZXJNYW5hZ2VyPFRVc2VyLCBUS2V5PiBtYW5hZ2VyLCBUVXNlciB1c2VyKQogICAgICAgIHsKICAgICAgICAgICAgaWYgKG1hbmFnZXIgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEFyZ3VtZW50TnVsbEV4Y2VwdGlvbigibWFuYWdlciIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBhdXRoeUlkID0gRmluZEF1dGh5SWQodXNlcik7CiAgICAgICAgICAgIHZhciBlbWFpbCA9IEZpbmRFbWFpbCh1c2VyKTsKICAgICAgICAgICAgdmFyIG9uZVRvdWNoQ2xpZW50ID0gbmV3IE9uZVRvdWNoQ2xpZW50KF9hdXRoeUtleSwgYXV0aHlJZCk7CiAgICAgICAgICAgIG9uZVRvdWNoQ2xpZW50LlNlbmRBcHByb3ZhbFJlcXVlc3QoIlJlcXVlc3QgbG9naW4gdG8gVHdpbGlvIGRlbW8gYXBwIiwgZW1haWwpOwoKICAgICAgICAgICAgcmV0dXJuIFRhc2suRnJvbVJlc3VsdCgwKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPGJvb2w+IFZhbGlkYXRlQXN5bmMoc3RyaW5nIHB1cnBvc2UsIHN0cmluZyB0b2tlbiwgVXNlck1hbmFnZXI8VFVzZXIsIFRLZXk+IG1hbmFnZXIsIFRVc2VyIHVzZXIpCiAgICAgICAgewogICAgICAgICAgICB2YXIgYXV0aHlTdGF0dXMgPSBGaW5kQXV0aHlTdGF0dXModXNlcik7CiAgICAgICAgICAgIHJldHVybiBhdXRoeVN0YXR1cyA9PSAiYXBwcm92ZWQiOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBzdHJpbmcgRmluZEF1dGh5SWQoVFVzZXIgdXNlcikKICAgICAgICB7CiAgICAgICAgICAgIHZhciB1c2VyVHlwZSA9IHVzZXIuR2V0VHlwZSgpOwogICAgICAgICAgICB2YXIgYXV0aHlJZFByb3AgPSB1c2VyVHlwZS5HZXRQcm9wZXJ0eSh0aGlzLkF1dGh5SWRQcm9wZXJ0eU5hbWUpOwoKICAgICAgICAgICAgaWYgKGF1dGh5SWRQcm9wID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oIkEgcHJvcGVydHkgbmFtZWQgezB9IGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0aGUgdXNlciBtb2RlbCIpOwoKICAgICAgICAgICAgdmFyIGlkID0gYXV0aHlJZFByb3AuR2V0VmFsdWUodXNlcik7CgogICAgICAgICAgICByZXR1cm4gKHN0cmluZylpZDsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgc3RhdGljIHN0cmluZyBGaW5kRW1haWwoVFVzZXIgdXNlcikKICAgICAgICB7CiAgICAgICAgICAgIHZhciB1c2VyVHlwZSA9IHVzZXIuR2V0VHlwZSgpOwogICAgICAgICAgICB2YXIgZW1haWxQcm9wID0gdXNlclR5cGUuR2V0UHJvcGVydHkoIkVtYWlsIik7CgogICAgICAgICAgICBpZiAoZW1haWxQcm9wID09IG51bGwpCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90SW1wbGVtZW50ZWRFeGNlcHRpb24oIkEgcHJvcGVydHkgbmFtZWQgezB9IGNvdWxkIG5vdCBiZSBmb3VuZCBvbiB0aGUgdXNlciBtb2RlbCIpOwoKICAgICAgICAgICAgdmFyIGVtYWlsID0gZW1haWxQcm9wLkdldFZhbHVlKHVzZXIpOwoKICAgICAgICAgICAgcmV0dXJuIChzdHJpbmcpZW1haWw7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBzdHJpbmcgRmluZEF1dGh5U3RhdHVzKFRVc2VyIHVzZXIpCiAgICAgICAgewogICAgICAgICAgICB2YXIgdXNlclR5cGUgPSB1c2VyLkdldFR5cGUoKTsKICAgICAgICAgICAgdmFyIGF1dGh5U3RhdHVzUHJvcCA9IHVzZXJUeXBlLkdldFByb3BlcnR5KCJBdXRoeVN0YXR1cyIpOwoKICAgICAgICAgICAgaWYgKGF1dGh5U3RhdHVzUHJvcCA9PSBudWxsKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEltcGxlbWVudGVkRXhjZXB0aW9uKCJBIHByb3BlcnR5IG5hbWVkIHswfSBjb3VsZCBub3QgYmUgZm91bmQgb24gdGhlIHVzZXIgbW9kZWwiKTsKCiAgICAgICAgICAgIHZhciBhdXRoeVN0YXR1cyA9IGF1dGh5U3RhdHVzUHJvcC5HZXRWYWx1ZSh1c2VyKTsKCiAgICAgICAgICAgIHJldHVybiAoc3RyaW5nKSBhdXRoeVN0YXR1czsKICAgICAgICB9CiAgICB9Cn0=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/App_Start/IdentityConfig.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWM7DQp1c2luZyBTeXN0ZW0uRGF0YS5FbnRpdHk7DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DbGFpbXM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHk7DQp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5LkVudGl0eUZyYW1ld29yazsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luOw0KdXNpbmcgTWljcm9zb2Z0Lk93aW4uU2VjdXJpdHk7DQp1c2luZyBBdXRoeTJGQS5Nb2RlbHM7DQp1c2luZyBBdXRoeTJGQS5Qcm92aWRlcnM7DQoNCm5hbWVzcGFjZSBBdXRoeTJGQQ0Kew0KICAgIHB1YmxpYyBjbGFzcyBFbWFpbFNlcnZpY2UgOiBJSWRlbnRpdHlNZXNzYWdlU2VydmljZQ0KICAgIHsNCiAgICAgICAgcHVibGljIFRhc2sgU2VuZEFzeW5jKElkZW50aXR5TWVzc2FnZSBtZXNzYWdlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBQbHVnIGluIHlvdXIgZW1haWwgc2VydmljZSBoZXJlIHRvIHNlbmQgYW4gZW1haWwuDQogICAgICAgICAgICByZXR1cm4gVGFzay5Gcm9tUmVzdWx0KDApOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcHVibGljIGNsYXNzIFNtc1NlcnZpY2UgOiBJSWRlbnRpdHlNZXNzYWdlU2VydmljZQ0KICAgIHsNCiAgICAgICAgcHVibGljIFRhc2sgU2VuZEFzeW5jKElkZW50aXR5TWVzc2FnZSBtZXNzYWdlKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBQbHVnIGluIHlvdXIgU01TIHNlcnZpY2UgaGVyZSB0byBzZW5kIGEgdGV4dCBtZXNzYWdlLg0KICAgICAgICAgICAgcmV0dXJuIFRhc2suRnJvbVJlc3VsdCgwKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gdXNlciBtYW5hZ2VyIHVzZWQgaW4gdGhpcyBhcHBsaWNhdGlvbi4gVXNlck1hbmFnZXIgaXMgZGVmaW5lZCBpbiBBU1AuTkVUIElkZW50aXR5IGFuZCBpcyB1c2VkIGJ5IHRoZSBhcHBsaWNhdGlvbi4NCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25Vc2VyTWFuYWdlciA6IFVzZXJNYW5hZ2VyPEFwcGxpY2F0aW9uVXNlcj4NCiAgICB7DQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyKElVc2VyU3RvcmU8QXBwbGljYXRpb25Vc2VyPiBzdG9yZSkNCiAgICAgICAgICAgIDogYmFzZShzdG9yZSkNCiAgICAgICAgew0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIHN0YXRpYyBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIENyZWF0ZShJZGVudGl0eUZhY3RvcnlPcHRpb25zPEFwcGxpY2F0aW9uVXNlck1hbmFnZXI+IG9wdGlvbnMsIElPd2luQ29udGV4dCBjb250ZXh0KSANCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIG1hbmFnZXIgPSBuZXcgQXBwbGljYXRpb25Vc2VyTWFuYWdlcihuZXcgVXNlclN0b3JlPEFwcGxpY2F0aW9uVXNlcj4oY29udGV4dC5HZXQ8QXBwbGljYXRpb25EYkNvbnRleHQ+KCkpKTsNCiAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB2YWxpZGF0aW9uIGxvZ2ljIGZvciB1c2VybmFtZXMNCiAgICAgICAgICAgIG1hbmFnZXIuVXNlclZhbGlkYXRvciA9IG5ldyBVc2VyVmFsaWRhdG9yPEFwcGxpY2F0aW9uVXNlcj4obWFuYWdlcikNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBBbGxvd09ubHlBbHBoYW51bWVyaWNVc2VyTmFtZXMgPSBmYWxzZSwNCiAgICAgICAgICAgICAgICBSZXF1aXJlVW5pcXVlRW1haWwgPSB0cnVlDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAvLyBDb25maWd1cmUgdmFsaWRhdGlvbiBsb2dpYyBmb3IgcGFzc3dvcmRzDQogICAgICAgICAgICBtYW5hZ2VyLlBhc3N3b3JkVmFsaWRhdG9yID0gbmV3IFBhc3N3b3JkVmFsaWRhdG9yDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgUmVxdWlyZWRMZW5ndGggPSA2LA0KICAgICAgICAgICAgICAgIFJlcXVpcmVOb25MZXR0ZXJPckRpZ2l0ID0gZmFsc2UsDQogICAgICAgICAgICAgICAgUmVxdWlyZURpZ2l0ID0gdHJ1ZSwNCiAgICAgICAgICAgICAgICBSZXF1aXJlTG93ZXJjYXNlID0gdHJ1ZSwNCiAgICAgICAgICAgICAgICBSZXF1aXJlVXBwZXJjYXNlID0gZmFsc2UsDQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAvLyBDb25maWd1cmUgdXNlciBsb2Nrb3V0IGRlZmF1bHRzDQogICAgICAgICAgICBtYW5hZ2VyLlVzZXJMb2Nrb3V0RW5hYmxlZEJ5RGVmYXVsdCA9IHRydWU7DQogICAgICAgICAgICBtYW5hZ2VyLkRlZmF1bHRBY2NvdW50TG9ja291dFRpbWVTcGFuID0gVGltZVNwYW4uRnJvbU1pbnV0ZXMoNSk7DQogICAgICAgICAgICBtYW5hZ2VyLk1heEZhaWxlZEFjY2Vzc0F0dGVtcHRzQmVmb3JlTG9ja291dCA9IDU7DQoNCiAgICAgICAgICAgIC8vIFJlZ2lzdGVyIHR3byBmYWN0b3IgYXV0aGVudGljYXRpb24gcHJvdmlkZXJzLiBUaGlzIGFwcGxpY2F0aW9uIHVzZXMgUGhvbmUgYW5kIEVtYWlscyBhcyBhIHN0ZXAgb2YgcmVjZWl2aW5nIGEgY29kZSBmb3IgdmVyaWZ5aW5nIHRoZSB1c2VyDQogICAgICAgICAgICAvLyBZb3UgY2FuIHdyaXRlIHlvdXIgb3duIHByb3ZpZGVyIGFuZCBwbHVnIGl0IGluIGhlcmUuDQogICAgICAgICAgICBtYW5hZ2VyLlJlZ2lzdGVyVHdvRmFjdG9yUHJvdmlkZXIoIkVtYWlsIENvZGUiLCBuZXcgRW1haWxUb2tlblByb3ZpZGVyPEFwcGxpY2F0aW9uVXNlcj4NCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBTdWJqZWN0ID0gIlNlY3VyaXR5IENvZGUiLA0KICAgICAgICAgICAgICAgIEJvZHlGb3JtYXQgPSAiWW91ciBzZWN1cml0eSBjb2RlIGlzIHswfSINCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAvLyBSZWdpc3RlciBBdXRoeSBhcyAyRkEgcHJvdmlkZXIgDQogICAgICAgICAgICBtYW5hZ2VyLlJlZ2lzdGVyVHdvRmFjdG9yUHJvdmlkZXIoIkF1dGh5IE9uZSBUb3VjaCIsIG5ldyBBdXRoeU9uZVRvdWNoUHJvdmlkZXI8QXBwbGljYXRpb25Vc2VyPigiQXV0aHlJZCIpKTsNCiAgICAgICAgICAgIG1hbmFnZXIuUmVnaXN0ZXJUd29GYWN0b3JQcm92aWRlcigiQXV0aHkgVG9rZW4iLCBuZXcgQXV0aHlUb2tlblByb3ZpZGVyPEFwcGxpY2F0aW9uVXNlcj4oIkF1dGh5SWQiKSk7DQoNCiAgICAgICAgICAgIG1hbmFnZXIuRW1haWxTZXJ2aWNlID0gbmV3IEVtYWlsU2VydmljZSgpOw0KICAgICAgICAgICAgbWFuYWdlci5TbXNTZXJ2aWNlID0gbmV3IFNtc1NlcnZpY2UoKTsNCiAgICAgICAgICAgIHZhciBkYXRhUHJvdGVjdGlvblByb3ZpZGVyID0gb3B0aW9ucy5EYXRhUHJvdGVjdGlvblByb3ZpZGVyOw0KICAgICAgICAgICAgaWYgKGRhdGFQcm90ZWN0aW9uUHJvdmlkZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBtYW5hZ2VyLlVzZXJUb2tlblByb3ZpZGVyID0gDQogICAgICAgICAgICAgICAgICAgIG5ldyBEYXRhUHJvdGVjdG9yVG9rZW5Qcm92aWRlcjxBcHBsaWNhdGlvblVzZXI+KGRhdGFQcm90ZWN0aW9uUHJvdmlkZXIuQ3JlYXRlKCJBU1AuTkVUIElkZW50aXR5IikpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIG1hbmFnZXI7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgQXBwbGljYXRpb25Vc2VyIEZpbmRCeUF1dGh5SWQoc3RyaW5nIGF1dGh5SWQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBVc2Vycy5GaXJzdE9yRGVmYXVsdCh4ID0+IHguQXV0aHlJZCA9PSBhdXRoeUlkKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBUYXNrPEFwcGxpY2F0aW9uVXNlcj4gRmluZEJ5QXV0aHlJZEFzeW5jKHN0cmluZyBhdXRoeUlkKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gVXNlcnMuRmlyc3RPckRlZmF1bHRBc3luYyh4ID0+IHguQXV0aHlJZCA9PSBhdXRoeUlkKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENvbmZpZ3VyZSB0aGUgYXBwbGljYXRpb24gc2lnbi1pbiBtYW5hZ2VyIHdoaWNoIGlzIHVzZWQgaW4gdGhpcyBhcHBsaWNhdGlvbi4NCiAgICBwdWJsaWMgY2xhc3MgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIDogU2lnbkluTWFuYWdlcjxBcHBsaWNhdGlvblVzZXIsIHN0cmluZz4NCiAgICB7DQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIoQXBwbGljYXRpb25Vc2VyTWFuYWdlciB1c2VyTWFuYWdlciwgSUF1dGhlbnRpY2F0aW9uTWFuYWdlciBhdXRoZW50aWNhdGlvbk1hbmFnZXIpDQogICAgICAgICAgICA6IGJhc2UodXNlck1hbmFnZXIsIGF1dGhlbnRpY2F0aW9uTWFuYWdlcikNCiAgICAgICAgew0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIG92ZXJyaWRlIFRhc2s8Q2xhaW1zSWRlbnRpdHk+IENyZWF0ZVVzZXJJZGVudGl0eUFzeW5jKEFwcGxpY2F0aW9uVXNlciB1c2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICByZXR1cm4gdXNlci5HZW5lcmF0ZVVzZXJJZGVudGl0eUFzeW5jKChBcHBsaWNhdGlvblVzZXJNYW5hZ2VyKVVzZXJNYW5hZ2VyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBzdGF0aWMgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIENyZWF0ZShJZGVudGl0eUZhY3RvcnlPcHRpb25zPEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcj4gb3B0aW9ucywgSU93aW5Db250ZXh0IGNvbnRleHQpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBuZXcgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyKGNvbnRleHQuR2V0VXNlck1hbmFnZXI8QXBwbGljYXRpb25Vc2VyTWFuYWdlcj4oKSwgY29udGV4dC5BdXRoZW50aWNhdGlvbik7DQogICAgICAgIH0NCiAgICB9DQp9DQo=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Controllers/ManageController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkxpbnE7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIFN5c3RlbS5XZWIuTXZjOw0KdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5Ow0KdXNpbmcgQXV0aHkyRkEuTW9kZWxzOw0KdXNpbmcgQXV0aHkuTmV0Ow0KdXNpbmcgU3lzdGVtLkNvbmZpZ3VyYXRpb247DQoNCm5hbWVzcGFjZSBBdXRoeTJGQS5Db250cm9sbGVycw0Kew0KICAgIFtBdXRob3JpemVdDQogICAgcHVibGljIGNsYXNzIE1hbmFnZUNvbnRyb2xsZXIgOiBDb250cm9sbGVyDQogICAgew0KICAgICAgICBwcml2YXRlIHN0YXRpYyBBdXRoeUNsaWVudCBfYXV0aHlDbGllbnQgPSBuZXcgQXV0aHlDbGllbnQoQ29uZmlndXJhdGlvbk1hbmFnZXIuQXBwU2V0dGluZ3NbIkF1dGh5S2V5Il0pOw0KICAgICAgICBwcml2YXRlIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBfc2lnbkluTWFuYWdlcjsNCiAgICAgICAgcHJpdmF0ZSBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIF91c2VyTWFuYWdlcjsNCg0KICAgICAgICBwdWJsaWMgTWFuYWdlQ29udHJvbGxlcigpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBNYW5hZ2VDb250cm9sbGVyKEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgdXNlck1hbmFnZXIsIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBzaWduSW5NYW5hZ2VyKQ0KICAgICAgICB7DQogICAgICAgICAgICBVc2VyTWFuYWdlciA9IHVzZXJNYW5hZ2VyOw0KICAgICAgICAgICAgU2lnbkluTWFuYWdlciA9IHNpZ25Jbk1hbmFnZXI7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIFNpZ25Jbk1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF9zaWduSW5NYW5hZ2VyID8/IEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuR2V0PEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcj4oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHByaXZhdGUgc2V0IA0KICAgICAgICAgICAgeyANCiAgICAgICAgICAgICAgICBfc2lnbkluTWFuYWdlciA9IHZhbHVlOyANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIFVzZXJNYW5hZ2VyDQogICAgICAgIHsNCiAgICAgICAgICAgIGdldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBfdXNlck1hbmFnZXIgPz8gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5HZXRVc2VyTWFuYWdlcjxBcHBsaWNhdGlvblVzZXJNYW5hZ2VyPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHJpdmF0ZSBzZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBfdXNlck1hbmFnZXIgPSB2YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9JbmRleA0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IEluZGV4KE1hbmFnZU1lc3NhZ2VJZD8gbWVzc2FnZSkNCiAgICAgICAgew0KICAgICAgICAgICAgVmlld0JhZy5TdGF0dXNNZXNzYWdlID0NCiAgICAgICAgICAgICAgICBtZXNzYWdlID09IE1hbmFnZU1lc3NhZ2VJZC5DaGFuZ2VQYXNzd29yZFN1Y2Nlc3MgPyAiWW91ciBwYXNzd29yZCBoYXMgYmVlbiBjaGFuZ2VkLiINCiAgICAgICAgICAgICAgICA6IG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLlNldFBhc3N3b3JkU3VjY2VzcyA/ICJZb3VyIHBhc3N3b3JkIGhhcyBiZWVuIHNldC4iDQogICAgICAgICAgICAgICAgOiBtZXNzYWdlID09IE1hbmFnZU1lc3NhZ2VJZC5TZXRUd29GYWN0b3JTdWNjZXNzID8gIllvdXIgdHdvLWZhY3RvciBhdXRoZW50aWNhdGlvbiBwcm92aWRlciBoYXMgYmVlbiBzZXQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgPyAiQW4gZXJyb3IgaGFzIG9jY3VycmVkLiINCiAgICAgICAgICAgICAgICA6IG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLkFkZFBob25lU3VjY2VzcyA/ICJZb3VyIHBob25lIG51bWJlciB3YXMgYWRkZWQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuUmVtb3ZlUGhvbmVTdWNjZXNzID8gIllvdXIgcGhvbmUgbnVtYmVyIHdhcyByZW1vdmVkLiINCiAgICAgICAgICAgICAgICA6ICIiOw0KDQogICAgICAgICAgICB2YXIgdXNlcklkID0gVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKTsNCiAgICAgICAgICAgIHZhciBtb2RlbCA9IG5ldyBJbmRleFZpZXdNb2RlbA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEhhc1Bhc3N3b3JkID0gSGFzUGFzc3dvcmQoKSwNCiAgICAgICAgICAgICAgICBQaG9uZU51bWJlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdldFBob25lTnVtYmVyQXN5bmModXNlcklkKSwNCiAgICAgICAgICAgICAgICBUd29GYWN0b3IgPSBhd2FpdCBVc2VyTWFuYWdlci5HZXRUd29GYWN0b3JFbmFibGVkQXN5bmModXNlcklkKSwNCiAgICAgICAgICAgICAgICBMb2dpbnMgPSBhd2FpdCBVc2VyTWFuYWdlci5HZXRMb2dpbnNBc3luYyh1c2VySWQpLA0KICAgICAgICAgICAgICAgIEJyb3dzZXJSZW1lbWJlcmVkID0gYXdhaXQgQXV0aGVudGljYXRpb25NYW5hZ2VyLlR3b0ZhY3RvckJyb3dzZXJSZW1lbWJlcmVkQXN5bmModXNlcklkKQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvUmVtb3ZlTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFJlbW92ZUxvZ2luKHN0cmluZyBsb2dpblByb3ZpZGVyLCBzdHJpbmcgcHJvdmlkZXJLZXkpDQogICAgICAgIHsNCiAgICAgICAgICAgIE1hbmFnZU1lc3NhZ2VJZD8gbWVzc2FnZTsNCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5SZW1vdmVMb2dpbkFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIG5ldyBVc2VyTG9naW5JbmZvKGxvZ2luUHJvdmlkZXIsIHByb3ZpZGVyS2V5KSk7DQogICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeUlkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFNpZ25Jbk1hbmFnZXIuU2lnbkluQXN5bmModXNlciwgaXNQZXJzaXN0ZW50OiBmYWxzZSwgcmVtZW1iZXJCcm93c2VyOiBmYWxzZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuUmVtb3ZlTG9naW5TdWNjZXNzOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3I7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiTWFuYWdlTG9naW5zIiwgbmV3IHsgTWVzc2FnZSA9IG1lc3NhZ2UgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9NYW5hZ2UvQWRkUGhvbmVOdW1iZXINCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBBZGRQaG9uZU51bWJlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0FkZFBob25lTnVtYmVyDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBBZGRQaG9uZU51bWJlcihBZGRQaG9uZU51bWJlclZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeUlkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBfYXV0aHlDbGllbnQuUmVnaXN0ZXJVc2VyKHVzZXIuRW1haWwsIG1vZGVsLk51bWJlciwgaW50LlBhcnNlKG1vZGVsLkNvdW50cnlDb2RlLlJlcGxhY2UoIisiLCAiIikpKTsNCiAgICAgICAgICAgICAgICB1c2VyLkF1dGh5SWQgPSByZXN1bHQuVXNlcklkOw0KICAgICAgICAgICAgICAgIGF3YWl0IFVzZXJNYW5hZ2VyLlVwZGF0ZUFzeW5jKHVzZXIpOw0KDQogICAgICAgICAgICAgICAgX2F1dGh5Q2xpZW50LlNlbmRTbXModXNlci5BdXRoeUlkKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIlZlcmlmeVBob25lTnVtYmVyIiwgbmV3IHsgUGhvbmVOdW1iZXIgPSBtb2RlbC5OdW1iZXIgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0VuYWJsZVR3b0ZhY3RvckF1dGhlbnRpY2F0aW9uDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBFbmFibGVUd29GYWN0b3JBdXRoZW50aWNhdGlvbigpDQogICAgICAgIHsNCiAgICAgICAgICAgIGF3YWl0IFVzZXJNYW5hZ2VyLlNldFR3b0ZhY3RvckVuYWJsZWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCB0cnVlKTsNCiAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgIGlmICh1c2VyICE9IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsICJNYW5hZ2UiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvRGlzYWJsZVR3b0ZhY3RvckF1dGhlbnRpY2F0aW9uDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBEaXNhYmxlVHdvRmFjdG9yQXV0aGVudGljYXRpb24oKQ0KICAgICAgICB7DQogICAgICAgICAgICBhd2FpdCBVc2VyTWFuYWdlci5TZXRUd29GYWN0b3JFbmFibGVkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSwgZmFsc2UpOw0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIk1hbmFnZSIpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL1ZlcmlmeVBob25lTnVtYmVyDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gVmVyaWZ5UGhvbmVOdW1iZXIoc3RyaW5nIHBob25lTnVtYmVyKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgY29kZSA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdlbmVyYXRlQ2hhbmdlUGhvbmVOdW1iZXJUb2tlbkFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIHBob25lTnVtYmVyKTsNCiAgICAgICAgICAgIC8vIFNlbmQgYW4gU01TIHRocm91Z2ggdGhlIFNNUyBwcm92aWRlciB0byB2ZXJpZnkgdGhlIHBob25lIG51bWJlcg0KICAgICAgICAgICAgcmV0dXJuIHBob25lTnVtYmVyID09IG51bGwgPyBWaWV3KCJFcnJvciIpIDogVmlldyhuZXcgVmVyaWZ5UGhvbmVOdW1iZXJWaWV3TW9kZWwgeyBQaG9uZU51bWJlciA9IHBob25lTnVtYmVyIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL01hbmFnZS9WZXJpZnlQaG9uZU51bWJlcg0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gVmVyaWZ5UGhvbmVOdW1iZXIoVmVyaWZ5UGhvbmVOdW1iZXJWaWV3TW9kZWwgbW9kZWwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZiAoX2F1dGh5Q2xpZW50LlZlcmlmeVRva2VuKHVzZXIuQXV0aHlJZCwgbW9kZWwuQ29kZSwgdHJ1ZSkuU3RhdHVzID09IEF1dGh5U3RhdHVzLlN1Y2Nlc3MpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB1c2VyLlBob25lTnVtYmVyID0gbW9kZWwuUGhvbmVOdW1iZXI7DQogICAgICAgICAgICAgICAgICAgIHVzZXIuUGhvbmVOdW1iZXJDb25maXJtZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBVc2VyTWFuYWdlci5VcGRhdGVBc3luYyh1c2VyKTsNCg0KICAgICAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuQWRkUGhvbmVTdWNjZXNzIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gSWYgd2UgZ290IHRoaXMgZmFyLCBzb21ldGhpbmcgZmFpbGVkLCByZWRpc3BsYXkgZm9ybQ0KICAgICAgICAgICAgTW9kZWxTdGF0ZS5BZGRNb2RlbEVycm9yKCIiLCAiRmFpbGVkIHRvIHZlcmlmeSBwaG9uZSIpOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL1JlbW92ZVBob25lTnVtYmVyDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gUmVtb3ZlUGhvbmVOdW1iZXIoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuU2V0UGhvbmVOdW1iZXJBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCBudWxsKTsNCiAgICAgICAgICAgIGlmICghcmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCBuZXcgeyBNZXNzYWdlID0gTWFuYWdlTWVzc2FnZUlkLkVycm9yIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBhd2FpdCBTaWduSW5NYW5hZ2VyLlNpZ25JbkFzeW5jKHVzZXIsIGlzUGVyc2lzdGVudDogZmFsc2UsIHJlbWVtYmVyQnJvd3NlcjogZmFsc2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgbmV3IHsgTWVzc2FnZSA9IE1hbmFnZU1lc3NhZ2VJZC5SZW1vdmVQaG9uZVN1Y2Nlc3MgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9NYW5hZ2UvQ2hhbmdlUGFzc3dvcmQNCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBDaGFuZ2VQYXNzd29yZCgpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvTWFuYWdlL0NoYW5nZVBhc3N3b3JkDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBDaGFuZ2VQYXNzd29yZChDaGFuZ2VQYXNzd29yZFZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNoYW5nZVBhc3N3b3JkQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSwgbW9kZWwuT2xkUGFzc3dvcmQsIG1vZGVsLk5ld1Bhc3N3b3JkKTsNCiAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2VlZGVkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgbmV3IHsgTWVzc2FnZSA9IE1hbmFnZU1lc3NhZ2VJZC5DaGFuZ2VQYXNzd29yZFN1Y2Nlc3MgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBBZGRFcnJvcnMocmVzdWx0KTsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9TZXRQYXNzd29yZA0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IFNldFBhc3N3b3JkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9NYW5hZ2UvU2V0UGFzc3dvcmQNCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFNldFBhc3N3b3JkKFNldFBhc3N3b3JkVmlld01vZGVsIG1vZGVsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5BZGRQYXNzd29yZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCksIG1vZGVsLk5ld1Bhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5SWRBc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgU2lnbkluTWFuYWdlci5TaWduSW5Bc3luYyh1c2VyLCBpc1BlcnNpc3RlbnQ6IGZhbHNlLCByZW1lbWJlckJyb3dzZXI6IGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0FjdGlvbigiSW5kZXgiLCBuZXcgeyBNZXNzYWdlID0gTWFuYWdlTWVzc2FnZUlkLlNldFBhc3N3b3JkU3VjY2VzcyB9KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQWRkRXJyb3JzKHJlc3VsdCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIElmIHdlIGdvdCB0aGlzIGZhciwgc29tZXRoaW5nIGZhaWxlZCwgcmVkaXNwbGF5IGZvcm0NCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL01hbmFnZS9NYW5hZ2VMb2dpbnMNCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBNYW5hZ2VMb2dpbnMoTWFuYWdlTWVzc2FnZUlkPyBtZXNzYWdlKQ0KICAgICAgICB7DQogICAgICAgICAgICBWaWV3QmFnLlN0YXR1c01lc3NhZ2UgPQ0KICAgICAgICAgICAgICAgIG1lc3NhZ2UgPT0gTWFuYWdlTWVzc2FnZUlkLlJlbW92ZUxvZ2luU3VjY2VzcyA/ICJUaGUgZXh0ZXJuYWwgbG9naW4gd2FzIHJlbW92ZWQuIg0KICAgICAgICAgICAgICAgIDogbWVzc2FnZSA9PSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgPyAiQW4gZXJyb3IgaGFzIG9jY3VycmVkLiINCiAgICAgICAgICAgICAgICA6ICIiOw0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciB1c2VyTG9naW5zID0gYXdhaXQgVXNlck1hbmFnZXIuR2V0TG9naW5zQXN5bmMoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICB2YXIgb3RoZXJMb2dpbnMgPSBBdXRoZW50aWNhdGlvbk1hbmFnZXIuR2V0RXh0ZXJuYWxBdXRoZW50aWNhdGlvblR5cGVzKCkuV2hlcmUoYXV0aCA9PiB1c2VyTG9naW5zLkFsbCh1bCA9PiBhdXRoLkF1dGhlbnRpY2F0aW9uVHlwZSAhPSB1bC5Mb2dpblByb3ZpZGVyKSkuVG9MaXN0KCk7DQogICAgICAgICAgICBWaWV3QmFnLlNob3dSZW1vdmVCdXR0b24gPSB1c2VyLlBhc3N3b3JkSGFzaCAhPSBudWxsIHx8IHVzZXJMb2dpbnMuQ291bnQgPiAxOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobmV3IE1hbmFnZUxvZ2luc1ZpZXdNb2RlbA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIEN1cnJlbnRMb2dpbnMgPSB1c2VyTG9naW5zLA0KICAgICAgICAgICAgICAgIE90aGVyTG9naW5zID0gb3RoZXJMb2dpbnMNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL01hbmFnZS9MaW5rTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IExpbmtMb2dpbihzdHJpbmcgcHJvdmlkZXIpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3QgYSByZWRpcmVjdCB0byB0aGUgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXIgdG8gbGluayBhIGxvZ2luIGZvciB0aGUgY3VycmVudCB1c2VyDQogICAgICAgICAgICByZXR1cm4gbmV3IEFjY291bnRDb250cm9sbGVyLkNoYWxsZW5nZVJlc3VsdChwcm92aWRlciwgVXJsLkFjdGlvbigiTGlua0xvZ2luQ2FsbGJhY2siLCAiTWFuYWdlIiksIFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvTWFuYWdlL0xpbmtMb2dpbkNhbGxiYWNrDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gTGlua0xvZ2luQ2FsbGJhY2soKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgbG9naW5JbmZvID0gYXdhaXQgQXV0aGVudGljYXRpb25NYW5hZ2VyLkdldEV4dGVybmFsTG9naW5JbmZvQXN5bmMoWHNyZktleSwgVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAobG9naW5JbmZvID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIk1hbmFnZUxvZ2lucyIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgfSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuQWRkTG9naW5Bc3luYyhVc2VyLklkZW50aXR5LkdldFVzZXJJZCgpLCBsb2dpbkluZm8uTG9naW4pOw0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5TdWNjZWVkZWQgPyBSZWRpcmVjdFRvQWN0aW9uKCJNYW5hZ2VMb2dpbnMiKSA6IFJlZGlyZWN0VG9BY3Rpb24oIk1hbmFnZUxvZ2lucyIsIG5ldyB7IE1lc3NhZ2UgPSBNYW5hZ2VNZXNzYWdlSWQuRXJyb3IgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBwcm90ZWN0ZWQgb3ZlcnJpZGUgdm9pZCBEaXNwb3NlKGJvb2wgZGlzcG9zaW5nKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoZGlzcG9zaW5nICYmIF91c2VyTWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF91c2VyTWFuYWdlci5EaXNwb3NlKCk7DQogICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5EaXNwb3NlKGRpc3Bvc2luZyk7DQogICAgICAgIH0NCg0KI3JlZ2lvbiBIZWxwZXJzDQogICAgICAgIC8vIFVzZWQgZm9yIFhTUkYgcHJvdGVjdGlvbiB3aGVuIGFkZGluZyBleHRlcm5hbCBsb2dpbnMNCiAgICAgICAgcHJpdmF0ZSBjb25zdCBzdHJpbmcgWHNyZktleSA9ICJYc3JmSWQiOw0KDQogICAgICAgIHByaXZhdGUgSUF1dGhlbnRpY2F0aW9uTWFuYWdlciBBdXRoZW50aWNhdGlvbk1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuQXV0aGVudGljYXRpb247DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIHZvaWQgQWRkRXJyb3JzKElkZW50aXR5UmVzdWx0IHJlc3VsdCkNCiAgICAgICAgew0KICAgICAgICAgICAgZm9yZWFjaCAodmFyIGVycm9yIGluIHJlc3VsdC5FcnJvcnMpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgTW9kZWxTdGF0ZS5BZGRNb2RlbEVycm9yKCIiLCBlcnJvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBwcml2YXRlIGJvb2wgSGFzUGFzc3dvcmQoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdXNlciA9IFVzZXJNYW5hZ2VyLkZpbmRCeUlkKFVzZXIuSWRlbnRpdHkuR2V0VXNlcklkKCkpOw0KICAgICAgICAgICAgaWYgKHVzZXIgIT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gdXNlci5QYXNzd29yZEhhc2ggIT0gbnVsbDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgYm9vbCBIYXNQaG9uZU51bWJlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB1c2VyID0gVXNlck1hbmFnZXIuRmluZEJ5SWQoVXNlci5JZGVudGl0eS5HZXRVc2VySWQoKSk7DQogICAgICAgICAgICBpZiAodXNlciAhPSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLlBob25lTnVtYmVyICE9IG51bGw7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCg0KICAgICAgICBwdWJsaWMgZW51bSBNYW5hZ2VNZXNzYWdlSWQNCiAgICAgICAgew0KICAgICAgICAgICAgQWRkUGhvbmVTdWNjZXNzLA0KICAgICAgICAgICAgQ2hhbmdlUGFzc3dvcmRTdWNjZXNzLA0KICAgICAgICAgICAgU2V0VHdvRmFjdG9yU3VjY2VzcywNCiAgICAgICAgICAgIFNldFBhc3N3b3JkU3VjY2VzcywNCiAgICAgICAgICAgIFJlbW92ZUxvZ2luU3VjY2VzcywNCiAgICAgICAgICAgIFJlbW92ZVBob25lU3VjY2VzcywNCiAgICAgICAgICAgIEVycm9yDQogICAgICAgIH0NCg0KI2VuZHJlZ2lvbg0KICAgIH0NCn0=</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Controllers/AuthyController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uQ29uZmlndXJhdGlvbjsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgU3lzdGVtLldlYjsKdXNpbmcgU3lzdGVtLldlYi5NdmM7CnVzaW5nIEF1dGh5MkZBLkRvbWFpbi5BdXRoeTsKdXNpbmcgQXV0aHkyRkEuTW9kZWxzOwp1c2luZyBNaWNyb3NvZnQuQXNwTmV0LklkZW50aXR5Lk93aW47CgovLyBSZVNoYXJwZXIgZGlzYWJsZSBJbmNvbnNpc3RlbnROYW1pbmcKCm5hbWVzcGFjZSBBdXRoeTJGQS5Db250cm9sbGVycwp7CiAgICBwdWJsaWMgY2xhc3MgQXV0aHlDb250cm9sbGVyIDogQ29udHJvbGxlcgogICAgewogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIFVzZXJNYW5hZ2VyCiAgICAgICAgewogICAgICAgICAgICBnZXQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuR2V0VXNlck1hbmFnZXI8QXBwbGljYXRpb25Vc2VyTWFuYWdlcj4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlciBTaWduSW5NYW5hZ2VyCiAgICAgICAgewogICAgICAgICAgICBnZXQKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuIEh0dHBDb250ZXh0LkdldE93aW5Db250ZXh0KCkuR2V0PEFwcGxpY2F0aW9uU2lnbkluTWFuYWdlcj4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8KICAgICAgICAvLyBQT1NUOiBBdXRoeS9DYWxsYmFjawogICAgICAgIFtIdHRwUG9zdF0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IENhbGxiYWNrKHN0cmluZyBhdXRoeV9pZCwgc3RyaW5nIHN0YXR1cykKICAgICAgICB7CiAgICAgICAgICAgIGlmICghQXV0aGVudGljYXRlQXV0aHlSZXF1ZXN0KCkpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIlRoaXMgcmVxdWVzdCBpcyB1bnNpZ25lZCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdXNlciA9IGF3YWl0IFVzZXJNYW5hZ2VyLkZpbmRCeUF1dGh5SWRBc3luYyhhdXRoeV9pZCk7CiAgICAgICAgICAgIHVzZXIuQXV0aHlTdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgICAgIGF3YWl0IFVzZXJNYW5hZ2VyLlVwZGF0ZUFzeW5jKHVzZXIpOwoKICAgICAgICAgICAgcmV0dXJuIENvbnRlbnQoIk9rIik7CiAgICAgICAgfQoKICAgICAgICAvLwogICAgICAgIC8vIFBPU1Q6IEF1dGh5L09uZVRvdWNoU3RhdHVzCiAgICAgICAgW0h0dHBQb3N0XQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gT25lVG91Y2hTdGF0dXMoKQogICAgICAgIHsKICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBHZXRQYXJ0aWFsbHlMb2dnZWRVc2VyKCk7CiAgICAgICAgICAgIGlmICh1c2VyID09IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIlVzZXIgaXMgZWl0aGVyIG5vdCBhdXRoZW50aWNhdGVkIG9yIGFscmVhZHkgbG9nZ2VkIGluIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBDb250ZW50KHVzZXIuQXV0aHlTdGF0dXMpOwogICAgICAgIH0KCiAgICAgICAgLy8vIDxzdW1tYXJ5PgogICAgICAgIC8vLyBHZXQgYSBwYXJ0aWFsbHkgbG9nZ2VkIHVzZXIsIHRoZSBzZWNvbmQgc3RlcCB2ZXJpZmljYXRpb24gc3RlcCBpcyBub3QgeWV0IGRvbmUKICAgICAgICAvLy8gPC9zdW1tYXJ5PgogICAgICAgIC8vLyA8cmV0dXJucz5BIHVzZXI8L3JldHVybnM+CiAgICAgICAgcHJpdmF0ZSBhc3luYyBUYXNrPEFwcGxpY2F0aW9uVXNlcj4gR2V0UGFydGlhbGx5TG9nZ2VkVXNlcigpCiAgICAgICAgewogICAgICAgICAgICB2YXIgdXNlcklkID0gYXdhaXQgU2lnbkluTWFuYWdlci5HZXRWZXJpZmllZFVzZXJJZEFzeW5jKCk7CiAgICAgICAgICAgIHJldHVybiBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlJZEFzeW5jKHVzZXJJZCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2wgQXV0aGVudGljYXRlQXV0aHlSZXF1ZXN0KCkKICAgICAgICB7CiAgICAgICAgICAgIHZhciBhcGlLZXkgPSBDb25maWd1cmF0aW9uTWFuYWdlci5BcHBTZXR0aW5nc1siQXV0aHlLZXkiXTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBPbmVUb3VjaFJlcXVlc3RWYWxpZGF0b3IoYXBpS2V5LCBSZXF1ZXN0KS5WYWxpZGF0ZSgpOwogICAgICAgIH0KICAgIH0KfQ==</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Scripts/onetouch.js" data-mode="javascript">77u/JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CiAgICB2YXIgY2hlY2tPbmVUb3VjaFN0YXR1cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICQucG9zdCgiL0F1dGh5L09uZVRvdWNoU3RhdHVzIikKICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChkYXRhID09PSAiYXBwcm92ZWQiIHx8IGRhdGEgPT09ICJkZW5pZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgJCgiZm9ybSIpLmdldCgwKS5zdWJtaXQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChjaGVja09uZVRvdWNoU3RhdHVzLCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICk7CiAgICB9CgogICAgY2hlY2tPbmVUb3VjaFN0YXR1cygpOwp9KQ==</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Controllers/AccountController.cs" data-mode="csharp">77u/dXNpbmcgU3lzdGVtOw0KdXNpbmcgU3lzdGVtLkdsb2JhbGl6YXRpb247DQp1c2luZyBTeXN0ZW0uTGlucTsNCnVzaW5nIFN5c3RlbS5TZWN1cml0eS5DbGFpbXM7DQp1c2luZyBTeXN0ZW0uVGhyZWFkaW5nLlRhc2tzOw0KdXNpbmcgU3lzdGVtLldlYjsNCnVzaW5nIFN5c3RlbS5XZWIuTXZjOw0KdXNpbmcgTWljcm9zb2Z0LkFzcE5ldC5JZGVudGl0eTsNCnVzaW5nIE1pY3Jvc29mdC5Bc3BOZXQuSWRlbnRpdHkuT3dpbjsNCnVzaW5nIE1pY3Jvc29mdC5Pd2luLlNlY3VyaXR5Ow0KdXNpbmcgQXV0aHkyRkEuTW9kZWxzOw0KDQpuYW1lc3BhY2UgQXV0aHkyRkEuQ29udHJvbGxlcnMNCnsNCiAgICBbQXV0aG9yaXplXQ0KICAgIHB1YmxpYyBjbGFzcyBBY2NvdW50Q29udHJvbGxlciA6IENvbnRyb2xsZXINCiAgICB7DQogICAgICAgIHByaXZhdGUgQXBwbGljYXRpb25TaWduSW5NYW5hZ2VyIF9zaWduSW5NYW5hZ2VyOw0KICAgICAgICBwcml2YXRlIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgX3VzZXJNYW5hZ2VyOw0KDQogICAgICAgIHB1YmxpYyBBY2NvdW50Q29udHJvbGxlcigpDQogICAgICAgIHsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBY2NvdW50Q29udHJvbGxlcihBcHBsaWNhdGlvblVzZXJNYW5hZ2VyIHVzZXJNYW5hZ2VyLCBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIgc2lnbkluTWFuYWdlciApDQogICAgICAgIHsNCiAgICAgICAgICAgIFVzZXJNYW5hZ2VyID0gdXNlck1hbmFnZXI7DQogICAgICAgICAgICBTaWduSW5NYW5hZ2VyID0gc2lnbkluTWFuYWdlcjsNCiAgICAgICAgfQ0KDQogICAgICAgIHB1YmxpYyBBcHBsaWNhdGlvblNpZ25Jbk1hbmFnZXIgU2lnbkluTWFuYWdlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3NpZ25Jbk1hbmFnZXIgPz8gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5HZXQ8QXBwbGljYXRpb25TaWduSW5NYW5hZ2VyPigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcHJpdmF0ZSBzZXQgDQogICAgICAgICAgICB7IA0KICAgICAgICAgICAgICAgIF9zaWduSW5NYW5hZ2VyID0gdmFsdWU7IA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcHVibGljIEFwcGxpY2F0aW9uVXNlck1hbmFnZXIgVXNlck1hbmFnZXINCiAgICAgICAgew0KICAgICAgICAgICAgZ2V0DQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIF91c2VyTWFuYWdlciA/PyBIdHRwQ29udGV4dC5HZXRPd2luQ29udGV4dCgpLkdldFVzZXJNYW5hZ2VyPEFwcGxpY2F0aW9uVXNlck1hbmFnZXI+KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBwcml2YXRlIHNldA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIF91c2VyTWFuYWdlciA9IHZhbHVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9Mb2dpbg0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgTG9naW4oc3RyaW5nIHJldHVyblVybCkNCiAgICAgICAgew0KICAgICAgICAgICAgVmlld0JhZy5SZXR1cm5VcmwgPSByZXR1cm5Vcmw7DQogICAgICAgICAgICByZXR1cm4gVmlldygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gTG9naW4oTG9naW5WaWV3TW9kZWwgbW9kZWwsIHN0cmluZyByZXR1cm5VcmwpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmICghTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gVGhpcyBkb2Vzbid0IGNvdW50IGxvZ2luIGZhaWx1cmVzIHRvd2FyZHMgYWNjb3VudCBsb2Nrb3V0DQogICAgICAgICAgICAvLyBUbyBlbmFibGUgcGFzc3dvcmQgZmFpbHVyZXMgdG8gdHJpZ2dlciBhY2NvdW50IGxvY2tvdXQsIGNoYW5nZSB0byBzaG91bGRMb2Nrb3V0OiB0cnVlDQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgU2lnbkluTWFuYWdlci5QYXNzd29yZFNpZ25JbkFzeW5jKG1vZGVsLkVtYWlsLCBtb2RlbC5QYXNzd29yZCwgbW9kZWwuUmVtZW1iZXJNZSwgc2hvdWxkTG9ja291dDogZmFsc2UpOw0KICAgICAgICAgICAgc3dpdGNoIChyZXN1bHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuU3VjY2VzczoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9Mb2NhbChyZXR1cm5VcmwpOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkxvY2tlZE91dDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkxvY2tvdXQiKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5SZXF1aXJlc1ZlcmlmaWNhdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIlNlbmRDb2RlIiwgbmV3IHsgUmV0dXJuVXJsID0gcmV0dXJuVXJsLCBSZW1lbWJlck1lID0gbW9kZWwuUmVtZW1iZXJNZSB9KTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5GYWlsdXJlOg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIE1vZGVsU3RhdGUuQWRkTW9kZWxFcnJvcigiIiwgIkludmFsaWQgbG9naW4gYXR0ZW1wdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9WZXJpZnlDb2RlDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBWZXJpZnlDb2RlKHN0cmluZyBwcm92aWRlciwgc3RyaW5nIHJldHVyblVybCwgYm9vbCByZW1lbWJlck1lKQ0KICAgICAgICB7DQogICAgICAgICAgICAvLyBSZXF1aXJlIHRoYXQgdGhlIHVzZXIgaGFzIGFscmVhZHkgbG9nZ2VkIGluIHZpYSB1c2VybmFtZS9wYXNzd29yZCBvciBleHRlcm5hbCBsb2dpbg0KICAgICAgICAgICAgaWYgKCFhd2FpdCBTaWduSW5NYW5hZ2VyLkhhc0JlZW5WZXJpZmllZEFzeW5jKCkpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkVycm9yIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gVmlldyhuZXcgVmVyaWZ5Q29kZVZpZXdNb2RlbCB7IFByb3ZpZGVyID0gcHJvdmlkZXIsIFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IHJlbWVtYmVyTWUgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9WZXJpZnlDb2RlDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFZlcmlmeUNvZGUoVmVyaWZ5Q29kZVZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGNvZGUgcHJvdGVjdHMgZm9yIGJydXRlIGZvcmNlIGF0dGFja3MgYWdhaW5zdCB0aGUgdHdvIGZhY3RvciBjb2Rlcy4gDQogICAgICAgICAgICAvLyBJZiBhIHVzZXIgZW50ZXJzIGluY29ycmVjdCBjb2RlcyBmb3IgYSBzcGVjaWZpZWQgYW1vdW50IG9mIHRpbWUgdGhlbiB0aGUgdXNlciBhY2NvdW50IA0KICAgICAgICAgICAgLy8gd2lsbCBiZSBsb2NrZWQgb3V0IGZvciBhIHNwZWNpZmllZCBhbW91bnQgb2YgdGltZS4gDQogICAgICAgICAgICAvLyBZb3UgY2FuIGNvbmZpZ3VyZSB0aGUgYWNjb3VudCBsb2Nrb3V0IHNldHRpbmdzIGluIElkZW50aXR5Q29uZmlnDQogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgU2lnbkluTWFuYWdlci5Ud29GYWN0b3JTaWduSW5Bc3luYyhtb2RlbC5Qcm92aWRlciwgbW9kZWwuQ29kZSwgaXNQZXJzaXN0ZW50OiAgbW9kZWwuUmVtZW1iZXJNZSwgcmVtZW1iZXJCcm93c2VyOiBtb2RlbC5SZW1lbWJlckJyb3dzZXIpOw0KICAgICAgICAgICAgc3dpdGNoIChyZXN1bHQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuU3VjY2VzczoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9Mb2NhbChtb2RlbC5SZXR1cm5VcmwpOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkxvY2tlZE91dDoNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkxvY2tvdXQiKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5GYWlsdXJlOg0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIE1vZGVsU3RhdGUuQWRkTW9kZWxFcnJvcigiIiwgIkludmFsaWQgY29kZS4iKTsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9WZXJpZnlPbmVUb3VjaA0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gVmVyaWZ5T25lVG91Y2goc3RyaW5nIHByb3ZpZGVyLCBzdHJpbmcgcmV0dXJuVXJsLCBib29sIHJlbWVtYmVyTWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFJlcXVpcmUgdGhhdCB0aGUgdXNlciBoYXMgYWxyZWFkeSBsb2dnZWQgaW4gdmlhIHVzZXJuYW1lL3Bhc3N3b3JkIG9yIGV4dGVybmFsIGxvZ2luDQogICAgICAgICAgICBpZiAoIWF3YWl0IFNpZ25Jbk1hbmFnZXIuSGFzQmVlblZlcmlmaWVkQXN5bmMoKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBWaWV3KG5ldyBWZXJpZnlPbmVUb3VjaFZpZXdNb2RlbCB7IFByb3ZpZGVyID0gcHJvdmlkZXIsIFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IHJlbWVtYmVyTWUgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9WZXJpZnlPbmVUb3VjaA0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBWZXJpZnlPbmVUb3VjaChWZXJpZnlPbmVUb3VjaFZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFNpZ25Jbk1hbmFnZXIuVHdvRmFjdG9yU2lnbkluQXN5bmMoDQogICAgICAgICAgICAgICAgbW9kZWwuUHJvdmlkZXIsIHN0cmluZy5FbXB0eSwgbW9kZWwuUmVtZW1iZXJNZSwgbW9kZWwuUmVtZW1iZXJCcm93c2VyKTsNCg0KICAgICAgICAgICAgUmVzZXRBdXRoeVN0YXR1cygpOw0KDQogICAgICAgICAgICBzd2l0Y2ggKHJlc3VsdCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5TdWNjZXNzOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0xvY2FsKG1vZGVsLlJldHVyblVybCk7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuTG9ja2VkT3V0Og0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiTG9ja291dCIpOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIC8vIGRlZmF1bHQgY2FzZSBjb3ZlcnMgU2lnbkluU3RhdHVzLkZhaWx1cmUNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkxvZ2luIik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L1JlZ2lzdGVyDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBSZWdpc3RlcigpDQogICAgICAgIHsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9SZWdpc3Rlcg0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBSZWdpc3RlcihSZWdpc3RlclZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKE1vZGVsU3RhdGUuSXNWYWxpZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG5ldyBBcHBsaWNhdGlvblVzZXIgeyBVc2VyTmFtZSA9IG1vZGVsLkVtYWlsLCBFbWFpbCA9IG1vZGVsLkVtYWlsIH07DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNyZWF0ZUFzeW5jKHVzZXIsIG1vZGVsLlBhc3N3b3JkKTsNCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlN1Y2NlZWRlZCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIGF3YWl0IFNpZ25Jbk1hbmFnZXIuU2lnbkluQXN5bmModXNlciwgaXNQZXJzaXN0ZW50OmZhbHNlLCByZW1lbWJlckJyb3dzZXI6ZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRvIGVuYWJsZSBhY2NvdW50IGNvbmZpcm1hdGlvbiBhbmQgcGFzc3dvcmQgcmVzZXQgcGxlYXNlIHZpc2l0IGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/TGlua0lEPTMyMDc3MQ0KICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGFuIGVtYWlsIHdpdGggdGhpcyBsaW5rDQogICAgICAgICAgICAgICAgICAgIC8vIHN0cmluZyBjb2RlID0gYXdhaXQgVXNlck1hbmFnZXIuR2VuZXJhdGVFbWFpbENvbmZpcm1hdGlvblRva2VuQXN5bmModXNlci5JZCk7DQogICAgICAgICAgICAgICAgICAgIC8vIHZhciBjYWxsYmFja1VybCA9IFVybC5BY3Rpb24oIkNvbmZpcm1FbWFpbCIsICJBY2NvdW50IiwgbmV3IHsgdXNlcklkID0gdXNlci5JZCwgY29kZSA9IGNvZGUgfSwgcHJvdG9jb2w6IFJlcXVlc3QuVXJsLlNjaGVtZSk7DQogICAgICAgICAgICAgICAgICAgIC8vIGF3YWl0IFVzZXJNYW5hZ2VyLlNlbmRFbWFpbEFzeW5jKHVzZXIuSWQsICJDb25maXJtIHlvdXIgYWNjb3VudCIsICJQbGVhc2UgY29uZmlybSB5b3VyIGFjY291bnQgYnkgY2xpY2tpbmcgPGEgaHJlZj1cIiIgKyBjYWxsYmFja1VybCArICJcIj5oZXJlPC9hPiIpOw0KDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsICJIb21lIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIEFkZEVycm9ycyhyZXN1bHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJZiB3ZSBnb3QgdGhpcyBmYXIsIHNvbWV0aGluZyBmYWlsZWQsIHJlZGlzcGxheSBmb3JtDQogICAgICAgICAgICByZXR1cm4gVmlldyhtb2RlbCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L0NvbmZpcm1FbWFpbA0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gQ29uZmlybUVtYWlsKHN0cmluZyB1c2VySWQsIHN0cmluZyBjb2RlKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAodXNlcklkID09IG51bGwgfHwgY29kZSA9PSBudWxsKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJFcnJvciIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNvbmZpcm1FbWFpbEFzeW5jKHVzZXJJZCwgY29kZSk7DQogICAgICAgICAgICByZXR1cm4gVmlldyhyZXN1bHQuU3VjY2VlZGVkID8gIkNvbmZpcm1FbWFpbCIgOiAiRXJyb3IiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRm9yZ290UGFzc3dvcmQNCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IEZvcmdvdFBhc3N3b3JkKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9BY2NvdW50L0ZvcmdvdFBhc3N3b3JkDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IEZvcmdvdFBhc3N3b3JkKEZvcmdvdFBhc3N3b3JkVmlld01vZGVsIG1vZGVsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciB1c2VyID0gYXdhaXQgVXNlck1hbmFnZXIuRmluZEJ5TmFtZUFzeW5jKG1vZGVsLkVtYWlsKTsNCiAgICAgICAgICAgICAgICBpZiAodXNlciA9PSBudWxsIHx8ICEoYXdhaXQgVXNlck1hbmFnZXIuSXNFbWFpbENvbmZpcm1lZEFzeW5jKHVzZXIuSWQpKSkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIC8vIERvbid0IHJldmVhbCB0aGF0IHRoZSB1c2VyIGRvZXMgbm90IGV4aXN0IG9yIGlzIG5vdCBjb25maXJtZWQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoIkZvcmdvdFBhc3N3b3JkQ29uZmlybWF0aW9uIik7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRvIGVuYWJsZSBhY2NvdW50IGNvbmZpcm1hdGlvbiBhbmQgcGFzc3dvcmQgcmVzZXQgcGxlYXNlIHZpc2l0IGh0dHA6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/TGlua0lEPTMyMDc3MQ0KICAgICAgICAgICAgICAgIC8vIFNlbmQgYW4gZW1haWwgd2l0aCB0aGlzIGxpbmsNCiAgICAgICAgICAgICAgICAvLyBzdHJpbmcgY29kZSA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdlbmVyYXRlUGFzc3dvcmRSZXNldFRva2VuQXN5bmModXNlci5JZCk7DQogICAgICAgICAgICAgICAgLy8gdmFyIGNhbGxiYWNrVXJsID0gVXJsLkFjdGlvbigiUmVzZXRQYXNzd29yZCIsICJBY2NvdW50IiwgbmV3IHsgdXNlcklkID0gdXNlci5JZCwgY29kZSA9IGNvZGUgfSwgcHJvdG9jb2w6IFJlcXVlc3QuVXJsLlNjaGVtZSk7CQkNCiAgICAgICAgICAgICAgICAvLyBhd2FpdCBVc2VyTWFuYWdlci5TZW5kRW1haWxBc3luYyh1c2VyLklkLCAiUmVzZXQgUGFzc3dvcmQiLCAiUGxlYXNlIHJlc2V0IHlvdXIgcGFzc3dvcmQgYnkgY2xpY2tpbmcgPGEgaHJlZj1cIiIgKyBjYWxsYmFja1VybCArICJcIj5oZXJlPC9hPiIpOw0KICAgICAgICAgICAgICAgIC8vIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJGb3Jnb3RQYXNzd29yZENvbmZpcm1hdGlvbiIsICJBY2NvdW50Iik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIElmIHdlIGdvdCB0aGlzIGZhciwgc29tZXRoaW5nIGZhaWxlZCwgcmVkaXNwbGF5IGZvcm0NCiAgICAgICAgICAgIHJldHVybiBWaWV3KG1vZGVsKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRm9yZ290UGFzc3dvcmRDb25maXJtYXRpb24NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IEZvcmdvdFBhc3N3b3JkQ29uZmlybWF0aW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvUmVzZXRQYXNzd29yZA0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgUmVzZXRQYXNzd29yZChzdHJpbmcgY29kZSkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIGNvZGUgPT0gbnVsbCA/IFZpZXcoIkVycm9yIikgOiBWaWV3KCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9SZXNldFBhc3N3b3JkDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBbVmFsaWRhdGVBbnRpRm9yZ2VyeVRva2VuXQ0KICAgICAgICBwdWJsaWMgYXN5bmMgVGFzazxBY3Rpb25SZXN1bHQ+IFJlc2V0UGFzc3dvcmQoUmVzZXRQYXNzd29yZFZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdmFyIHVzZXIgPSBhd2FpdCBVc2VyTWFuYWdlci5GaW5kQnlOYW1lQXN5bmMobW9kZWwuRW1haWwpOw0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAvLyBEb24ndCByZXZlYWwgdGhhdCB0aGUgdXNlciBkb2VzIG5vdCBleGlzdA0KICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJSZXNldFBhc3N3b3JkQ29uZmlybWF0aW9uIiwgIkFjY291bnQiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBVc2VyTWFuYWdlci5SZXNldFBhc3N3b3JkQXN5bmModXNlci5JZCwgbW9kZWwuQ29kZSwgbW9kZWwuUGFzc3dvcmQpOw0KICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZWVkZWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIlJlc2V0UGFzc3dvcmRDb25maXJtYXRpb24iLCAiQWNjb3VudCIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgQWRkRXJyb3JzKHJlc3VsdCk7DQogICAgICAgICAgICByZXR1cm4gVmlldygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gR0VUOiAvQWNjb3VudC9SZXNldFBhc3N3b3JkQ29uZmlybWF0aW9uDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBSZXNldFBhc3N3b3JkQ29uZmlybWF0aW9uKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9BY2NvdW50L0V4dGVybmFsTG9naW4NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBBY3Rpb25SZXN1bHQgRXh0ZXJuYWxMb2dpbihzdHJpbmcgcHJvdmlkZXIsIHN0cmluZyByZXR1cm5VcmwpDQogICAgICAgIHsNCiAgICAgICAgICAgIC8vIFJlcXVlc3QgYSByZWRpcmVjdCB0byB0aGUgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXINCiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hhbGxlbmdlUmVzdWx0KHByb3ZpZGVyLCBVcmwuQWN0aW9uKCJFeHRlcm5hbExvZ2luQ2FsbGJhY2siLCAiQWNjb3VudCIsIG5ldyB7IFJldHVyblVybCA9IHJldHVyblVybCB9KSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBHRVQ6IC9BY2NvdW50L1NlbmRDb2RlDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBTZW5kQ29kZShzdHJpbmcgcmV0dXJuVXJsLCBib29sIHJlbWVtYmVyTWUpDQogICAgICAgIHsNCiAgICAgICAgICAgIHZhciB1c2VySWQgPSBhd2FpdCBTaWduSW5NYW5hZ2VyLkdldFZlcmlmaWVkVXNlcklkQXN5bmMoKTsNCiAgICAgICAgICAgIGlmICh1c2VySWQgPT0gbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHZhciB1c2VyRmFjdG9ycyA9IGF3YWl0IFVzZXJNYW5hZ2VyLkdldFZhbGlkVHdvRmFjdG9yUHJvdmlkZXJzQXN5bmModXNlcklkKTsNCiAgICAgICAgICAgIHZhciBmYWN0b3JPcHRpb25zID0gdXNlckZhY3RvcnMuU2VsZWN0KHB1cnBvc2UgPT4gbmV3IFNlbGVjdExpc3RJdGVtIHsgVGV4dCA9IHB1cnBvc2UsIFZhbHVlID0gcHVycG9zZSB9KS5Ub0xpc3QoKTsNCiAgICAgICAgICAgIHJldHVybiBWaWV3KG5ldyBTZW5kQ29kZVZpZXdNb2RlbCB7IFByb3ZpZGVycyA9IGZhY3Rvck9wdGlvbnMsIFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IHJlbWVtYmVyTWUgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLw0KICAgICAgICAvLyBQT1NUOiAvQWNjb3VudC9TZW5kQ29kZQ0KICAgICAgICBbSHR0cFBvc3RdDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBTZW5kQ29kZShTZW5kQ29kZVZpZXdNb2RlbCBtb2RlbCkNCiAgICAgICAgew0KICAgICAgICAgICAgaWYgKCFNb2RlbFN0YXRlLklzVmFsaWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gR2VuZXJhdGUgdGhlIHRva2VuIGFuZCBzZW5kIGl0DQogICAgICAgICAgICBpZiAoIWF3YWl0IFNpZ25Jbk1hbmFnZXIuU2VuZFR3b0ZhY3RvckNvZGVBc3luYyhtb2RlbC5TZWxlY3RlZFByb3ZpZGVyKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gVmlldygiRXJyb3IiKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKG1vZGVsLlNlbGVjdGVkUHJvdmlkZXIuRXF1YWxzKCJBdXRoeSBUb2tlbiIpKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJWZXJpZnlDb2RlIiwNCiAgICAgICAgICAgICAgICAgICAgbmV3IHsgUHJvdmlkZXIgPSBtb2RlbC5TZWxlY3RlZFByb3ZpZGVyLCBSZXR1cm5VcmwgPSBtb2RlbC5SZXR1cm5VcmwsIFJlbWVtYmVyTWUgPSBtb2RlbC5SZW1lbWJlck1lIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJWZXJpZnlPbmVUb3VjaCIsDQogICAgICAgICAgICAgICAgICAgIG5ldyB7IFByb3ZpZGVyID0gbW9kZWwuU2VsZWN0ZWRQcm92aWRlciwgUmV0dXJuVXJsID0gbW9kZWwuUmV0dXJuVXJsLCBSZW1lbWJlck1lID0gbW9kZWwuUmVtZW1iZXJNZSB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRXh0ZXJuYWxMb2dpbkNhbGxiYWNrDQogICAgICAgIFtBbGxvd0Fub255bW91c10NCiAgICAgICAgcHVibGljIGFzeW5jIFRhc2s8QWN0aW9uUmVzdWx0PiBFeHRlcm5hbExvZ2luQ2FsbGJhY2soc3RyaW5nIHJldHVyblVybCkNCiAgICAgICAgew0KICAgICAgICAgICAgdmFyIGxvZ2luSW5mbyA9IGF3YWl0IEF1dGhlbnRpY2F0aW9uTWFuYWdlci5HZXRFeHRlcm5hbExvZ2luSW5mb0FzeW5jKCk7DQogICAgICAgICAgICBpZiAobG9naW5JbmZvID09IG51bGwpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkxvZ2luIik7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFNpZ24gaW4gdGhlIHVzZXIgd2l0aCB0aGlzIGV4dGVybmFsIGxvZ2luIHByb3ZpZGVyIGlmIHRoZSB1c2VyIGFscmVhZHkgaGFzIGEgbG9naW4NCiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBTaWduSW5NYW5hZ2VyLkV4dGVybmFsU2lnbkluQXN5bmMobG9naW5JbmZvLCBpc1BlcnNpc3RlbnQ6IGZhbHNlKTsNCiAgICAgICAgICAgIHN3aXRjaCAocmVzdWx0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLlN1Y2Nlc3M6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvTG9jYWwocmV0dXJuVXJsKTsNCiAgICAgICAgICAgICAgICBjYXNlIFNpZ25JblN0YXR1cy5Mb2NrZWRPdXQ6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJMb2Nrb3V0Iik7DQogICAgICAgICAgICAgICAgY2FzZSBTaWduSW5TdGF0dXMuUmVxdWlyZXNWZXJpZmljYXRpb246DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJTZW5kQ29kZSIsIG5ldyB7IFJldHVyblVybCA9IHJldHVyblVybCwgUmVtZW1iZXJNZSA9IGZhbHNlIH0pOw0KICAgICAgICAgICAgICAgIGNhc2UgU2lnbkluU3RhdHVzLkZhaWx1cmU6DQogICAgICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHVzZXIgZG9lcyBub3QgaGF2ZSBhbiBhY2NvdW50LCB0aGVuIHByb21wdCB0aGUgdXNlciB0byBjcmVhdGUgYW4gYWNjb3VudA0KICAgICAgICAgICAgICAgICAgICBWaWV3QmFnLlJldHVyblVybCA9IHJldHVyblVybDsNCiAgICAgICAgICAgICAgICAgICAgVmlld0JhZy5Mb2dpblByb3ZpZGVyID0gbG9naW5JbmZvLkxvZ2luLkxvZ2luUHJvdmlkZXI7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJFeHRlcm5hbExvZ2luQ29uZmlybWF0aW9uIiwgbmV3IEV4dGVybmFsTG9naW5Db25maXJtYXRpb25WaWV3TW9kZWwgeyBFbWFpbCA9IGxvZ2luSW5mby5FbWFpbCB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIFBPU1Q6IC9BY2NvdW50L0V4dGVybmFsTG9naW5Db25maXJtYXRpb24NCiAgICAgICAgW0h0dHBQb3N0XQ0KICAgICAgICBbQWxsb3dBbm9ueW1vdXNdDQogICAgICAgIFtWYWxpZGF0ZUFudGlGb3JnZXJ5VG9rZW5dDQogICAgICAgIHB1YmxpYyBhc3luYyBUYXNrPEFjdGlvblJlc3VsdD4gRXh0ZXJuYWxMb2dpbkNvbmZpcm1hdGlvbihFeHRlcm5hbExvZ2luQ29uZmlybWF0aW9uVmlld01vZGVsIG1vZGVsLCBzdHJpbmcgcmV0dXJuVXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoVXNlci5JZGVudGl0eS5Jc0F1dGhlbnRpY2F0ZWQpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIk1hbmFnZSIpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoTW9kZWxTdGF0ZS5Jc1ZhbGlkKQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgZnJvbSB0aGUgZXh0ZXJuYWwgbG9naW4gcHJvdmlkZXINCiAgICAgICAgICAgICAgICB2YXIgaW5mbyA9IGF3YWl0IEF1dGhlbnRpY2F0aW9uTWFuYWdlci5HZXRFeHRlcm5hbExvZ2luSW5mb0FzeW5jKCk7DQogICAgICAgICAgICAgICAgaWYgKGluZm8gPT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBWaWV3KCJFeHRlcm5hbExvZ2luRmFpbHVyZSIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgdXNlciA9IG5ldyBBcHBsaWNhdGlvblVzZXIgeyBVc2VyTmFtZSA9IG1vZGVsLkVtYWlsLCBFbWFpbCA9IG1vZGVsLkVtYWlsIH07DQogICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IFVzZXJNYW5hZ2VyLkNyZWF0ZUFzeW5jKHVzZXIpOw0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuU3VjY2VlZGVkKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgVXNlck1hbmFnZXIuQWRkTG9naW5Bc3luYyh1c2VyLklkLCBpbmZvLkxvZ2luKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5TdWNjZWVkZWQpDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IFNpZ25Jbk1hbmFnZXIuU2lnbkluQXN5bmModXNlciwgaXNQZXJzaXN0ZW50OiBmYWxzZSwgcmVtZW1iZXJCcm93c2VyOiBmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3RUb0xvY2FsKHJldHVyblVybCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgQWRkRXJyb3JzKHJlc3VsdCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIFZpZXdCYWcuUmV0dXJuVXJsID0gcmV0dXJuVXJsOw0KICAgICAgICAgICAgcmV0dXJuIFZpZXcobW9kZWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8NCiAgICAgICAgLy8gUE9TVDogL0FjY291bnQvTG9nT2ZmDQogICAgICAgIFtIdHRwUG9zdF0NCiAgICAgICAgW1ZhbGlkYXRlQW50aUZvcmdlcnlUb2tlbl0NCiAgICAgICAgcHVibGljIEFjdGlvblJlc3VsdCBMb2dPZmYoKQ0KICAgICAgICB7DQogICAgICAgICAgICBBdXRoZW50aWNhdGlvbk1hbmFnZXIuU2lnbk91dCgpOw0KICAgICAgICAgICAgcmV0dXJuIFJlZGlyZWN0VG9BY3Rpb24oIkluZGV4IiwgIkhvbWUiKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vDQogICAgICAgIC8vIEdFVDogL0FjY291bnQvRXh0ZXJuYWxMb2dpbkZhaWx1cmUNCiAgICAgICAgW0FsbG93QW5vbnltb3VzXQ0KICAgICAgICBwdWJsaWMgQWN0aW9uUmVzdWx0IEV4dGVybmFsTG9naW5GYWlsdXJlKCkNCiAgICAgICAgew0KICAgICAgICAgICAgcmV0dXJuIFZpZXcoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHByb3RlY3RlZCBvdmVycmlkZSB2b2lkIERpc3Bvc2UoYm9vbCBkaXNwb3NpbmcpDQogICAgICAgIHsNCiAgICAgICAgICAgIGlmIChkaXNwb3NpbmcpDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWYgKF91c2VyTWFuYWdlciAhPSBudWxsKQ0KICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgX3VzZXJNYW5hZ2VyID0gbnVsbDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoX3NpZ25Jbk1hbmFnZXIgIT0gbnVsbCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIF9zaWduSW5NYW5hZ2VyLkRpc3Bvc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgX3NpZ25Jbk1hbmFnZXIgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgYmFzZS5EaXNwb3NlKGRpc3Bvc2luZyk7DQogICAgICAgIH0NCg0KICAgICAgICAjcmVnaW9uIEhlbHBlcnMNCiAgICAgICAgLy8gVXNlZCBmb3IgWFNSRiBwcm90ZWN0aW9uIHdoZW4gYWRkaW5nIGV4dGVybmFsIGxvZ2lucw0KICAgICAgICBwcml2YXRlIGNvbnN0IHN0cmluZyBYc3JmS2V5ID0gIlhzcmZJZCI7DQoNCiAgICAgICAgcHJpdmF0ZSBJQXV0aGVudGljYXRpb25NYW5hZ2VyIEF1dGhlbnRpY2F0aW9uTWFuYWdlcg0KICAgICAgICB7DQogICAgICAgICAgICBnZXQNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5BdXRoZW50aWNhdGlvbjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgdm9pZCBBZGRFcnJvcnMoSWRlbnRpdHlSZXN1bHQgcmVzdWx0KQ0KICAgICAgICB7DQogICAgICAgICAgICBmb3JlYWNoICh2YXIgZXJyb3IgaW4gcmVzdWx0LkVycm9ycykNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBNb2RlbFN0YXRlLkFkZE1vZGVsRXJyb3IoIiIsIGVycm9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHByaXZhdGUgQWN0aW9uUmVzdWx0IFJlZGlyZWN0VG9Mb2NhbChzdHJpbmcgcmV0dXJuVXJsKQ0KICAgICAgICB7DQogICAgICAgICAgICBpZiAoVXJsLklzTG9jYWxVcmwocmV0dXJuVXJsKSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gUmVkaXJlY3QocmV0dXJuVXJsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBSZWRpcmVjdFRvQWN0aW9uKCJJbmRleCIsICJIb21lIik7DQogICAgICAgIH0NCg0KICAgICAgICBpbnRlcm5hbCBjbGFzcyBDaGFsbGVuZ2VSZXN1bHQgOiBIdHRwVW5hdXRob3JpemVkUmVzdWx0DQogICAgICAgIHsNCiAgICAgICAgICAgIHB1YmxpYyBDaGFsbGVuZ2VSZXN1bHQoc3RyaW5nIHByb3ZpZGVyLCBzdHJpbmcgcmVkaXJlY3RVcmkpDQogICAgICAgICAgICAgICAgOiB0aGlzKHByb3ZpZGVyLCByZWRpcmVjdFVyaSwgbnVsbCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcHVibGljIENoYWxsZW5nZVJlc3VsdChzdHJpbmcgcHJvdmlkZXIsIHN0cmluZyByZWRpcmVjdFVyaSwgc3RyaW5nIHVzZXJJZCkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBMb2dpblByb3ZpZGVyID0gcHJvdmlkZXI7DQogICAgICAgICAgICAgICAgUmVkaXJlY3RVcmkgPSByZWRpcmVjdFVyaTsNCiAgICAgICAgICAgICAgICBVc2VySWQgPSB1c2VySWQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgTG9naW5Qcm92aWRlciB7IGdldDsgc2V0OyB9DQogICAgICAgICAgICBwdWJsaWMgc3RyaW5nIFJlZGlyZWN0VXJpIHsgZ2V0OyBzZXQ7IH0NCiAgICAgICAgICAgIHB1YmxpYyBzdHJpbmcgVXNlcklkIHsgZ2V0OyBzZXQ7IH0NCg0KICAgICAgICAgICAgcHVibGljIG92ZXJyaWRlIHZvaWQgRXhlY3V0ZVJlc3VsdChDb250cm9sbGVyQ29udGV4dCBjb250ZXh0KQ0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gbmV3IEF1dGhlbnRpY2F0aW9uUHJvcGVydGllcyB7IFJlZGlyZWN0VXJpID0gUmVkaXJlY3RVcmkgfTsNCiAgICAgICAgICAgICAgICBpZiAoVXNlcklkICE9IG51bGwpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLkRpY3Rpb25hcnlbWHNyZktleV0gPSBVc2VySWQ7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuSHR0cENvbnRleHQuR2V0T3dpbkNvbnRleHQoKS5BdXRoZW50aWNhdGlvbi5DaGFsbGVuZ2UocHJvcGVydGllcywgTG9naW5Qcm92aWRlcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLy8gPHN1bW1hcnk+DQogICAgICAgIC8vLyBSZXNldCBBdXRoeSBTdGF0dXMgYWZ0ZXIgc2lnbiBpbi4NCiAgICAgICAgLy8vIDwvc3VtbWFyeT4NCiAgICAgICAgcHJpdmF0ZSB2b2lkIFJlc2V0QXV0aHlTdGF0dXMoKQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgdXNlcklkID0gU2lnbkluTWFuYWdlci5HZXRWZXJpZmllZFVzZXJJZCgpOw0KICAgICAgICAgICAgdmFyIHVzZXIgPSBVc2VyTWFuYWdlci5GaW5kQnlJZCh1c2VySWQpOw0KICAgICAgICAgICAgdXNlci5BdXRoeVN0YXR1cyA9IHN0cmluZy5FbXB0eTsNCiAgICAgICAgICAgIFVzZXJNYW5hZ2VyLlVwZGF0ZSh1c2VyKTsNCiAgICAgICAgfQ0KICAgICAgICAjZW5kcmVnaW9uDQoNCiAgICB9DQp9</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Views/Account/Login.cshtml" data-mode="html">77u/QHVzaW5nIEF1dGh5MkZBLk1vZGVscw0KQG1vZGVsIExvZ2luVmlld01vZGVsDQpAew0KICAgIFZpZXdCYWcuVGl0bGUgPSAiTG9nIGluIjsNCn0NCg0KPGgyPkBWaWV3QmFnLlRpdGxlLjwvaDI+DQo8ZGl2IGNsYXNzPSJyb3ciPg0KICAgIDxkaXYgY2xhc3M9ImNvbC1tZC04Ij4NCiAgICAgICAgPHNlY3Rpb24gaWQ9ImxvZ2luRm9ybSI+DQogICAgICAgICAgICBAdXNpbmcgKEh0bWwuQmVnaW5Gb3JtKCJMb2dpbiIsICJBY2NvdW50IiwgbmV3IHsgUmV0dXJuVXJsID0gVmlld0JhZy5SZXR1cm5VcmwgfSwgRm9ybU1ldGhvZC5Qb3N0LCBuZXcgeyBAY2xhc3MgPSAiZm9ybS1ob3Jpem9udGFsIiwgcm9sZSA9ICJmb3JtIiB9KSkNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBASHRtbC5BbnRpRm9yZ2VyeVRva2VuKCkNCiAgICAgICAgICAgICAgICA8aDQ+VXNlIGEgbG9jYWwgYWNjb3VudCB0byBsb2cgaW4uPC9oND4NCiAgICAgICAgICAgICAgICA8aHIgLz4NCiAgICAgICAgICAgICAgICBASHRtbC5WYWxpZGF0aW9uU3VtbWFyeSh0cnVlLCAiIiwgbmV3IHsgQGNsYXNzID0gInRleHQtZGFuZ2VyIiB9KQ0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICBASHRtbC5MYWJlbEZvcihtID0+IG0uRW1haWwsIG5ldyB7IEBjbGFzcyA9ICJjb2wtbWQtMiBjb250cm9sLWxhYmVsIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuVGV4dEJveEZvcihtID0+IG0uRW1haWwsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWNvbnRyb2wiIH0pDQogICAgICAgICAgICAgICAgICAgICAgICBASHRtbC5WYWxpZGF0aW9uTWVzc2FnZUZvcihtID0+IG0uRW1haWwsICIiLCBuZXcgeyBAY2xhc3MgPSAidGV4dC1kYW5nZXIiIH0pDQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICAgICAgICAgICAgICBASHRtbC5MYWJlbEZvcihtID0+IG0uUGFzc3dvcmQsIG5ldyB7IEBjbGFzcyA9ICJjb2wtbWQtMiBjb250cm9sLWxhYmVsIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuUGFzc3dvcmRGb3IobSA9PiBtLlBhc3N3b3JkLCBuZXcgeyBAY2xhc3MgPSAiZm9ybS1jb250cm9sIiB9KQ0KICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuVmFsaWRhdGlvbk1lc3NhZ2VGb3IobSA9PiBtLlBhc3N3b3JkLCAiIiwgbmV3IHsgQGNsYXNzID0gInRleHQtZGFuZ2VyIiB9KQ0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLW9mZnNldC0yIGNvbC1tZC0xMCI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJjaGVja2JveCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuQ2hlY2tCb3hGb3IobSA9PiBtLlJlbWVtYmVyTWUpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQEh0bWwuTGFiZWxGb3IobSA9PiBtLlJlbWVtYmVyTWUpDQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC1vZmZzZXQtMiBjb2wtbWQtMTAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkxvZyBpbiIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIgLz4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPHA+DQogICAgICAgICAgICAgICAgICAgIEBIdG1sLkFjdGlvbkxpbmsoIlJlZ2lzdGVyIGFzIGEgbmV3IHVzZXIiLCAiUmVnaXN0ZXIiKQ0KICAgICAgICAgICAgICAgIDwvcD4NCiAgICAgICAgICAgICAgICBAKiBFbmFibGUgdGhpcyBvbmNlIHlvdSBoYXZlIGFjY291bnQgY29uZmlybWF0aW9uIGVuYWJsZWQgZm9yIHBhc3N3b3JkIHJlc2V0IGZ1bmN0aW9uYWxpdHkNCiAgICAgICAgICAgICAgICAgICAgPHA+DQogICAgICAgICAgICAgICAgICAgICAgICBASHRtbC5BY3Rpb25MaW5rKCJGb3Jnb3QgeW91ciBwYXNzd29yZD8iLCAiRm9yZ290UGFzc3dvcmQiKQ0KICAgICAgICAgICAgICAgICAgICA8L3A+KkANCiAgICAgICAgICAgIH0NCiAgICAgICAgPC9zZWN0aW9uPg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9ImNvbC1tZC00Ij4NCiAgICAgICAgPHNlY3Rpb24gaWQ9InNvY2lhbExvZ2luRm9ybSI+DQogICAgICAgICAgICBASHRtbC5QYXJ0aWFsKCJfRXh0ZXJuYWxMb2dpbnNMaXN0UGFydGlhbCIsIG5ldyBFeHRlcm5hbExvZ2luTGlzdFZpZXdNb2RlbCB7IFJldHVyblVybCA9IFZpZXdCYWcuUmV0dXJuVXJsIH0pDQogICAgICAgIDwvc2VjdGlvbj4NCiAgICA8L2Rpdj4NCjwvZGl2Pg0KDQpAc2VjdGlvbiBTY3JpcHRzIHsNCiAgICBAU2NyaXB0cy5SZW5kZXIoIn4vYnVuZGxlcy9qcXVlcnl2YWwiKQ0KfQ==</textarea>
<textarea class="saurus-file" data-file="Authy2FA/Views/Account/VerifyCode.cshtml" data-mode="html">77u/QG1vZGVsIEF1dGh5MkZBLk1vZGVscy5WZXJpZnlDb2RlVmlld01vZGVsDQpAew0KICAgIFZpZXdCYWcuVGl0bGUgPSAiVmVyaWZ5IjsNCn0NCg0KPGgyPkBWaWV3QmFnLlRpdGxlLjwvaDI+DQoNCkB1c2luZyAoSHRtbC5CZWdpbkZvcm0oIlZlcmlmeUNvZGUiLCAiQWNjb3VudCIsIG5ldyB7IFJldHVyblVybCA9IE1vZGVsLlJldHVyblVybCB9LCBGb3JtTWV0aG9kLlBvc3QsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWhvcml6b250YWwiLCByb2xlID0gImZvcm0iIH0pKSB7DQogICAgQEh0bWwuQW50aUZvcmdlcnlUb2tlbigpDQogICAgQEh0bWwuSGlkZGVuKCJwcm92aWRlciIsIEBNb2RlbC5Qcm92aWRlcikNCiAgICBASHRtbC5IaWRkZW4oInJlbWVtYmVyTWUiLCBATW9kZWwuUmVtZW1iZXJNZSkNCiAgICA8aDQ+RW50ZXIgdmVyaWZpY2F0aW9uIGNvZGU8L2g0Pg0KICAgIDxociAvPg0KICAgIEBIdG1sLlZhbGlkYXRpb25TdW1tYXJ5KCIiLCBuZXcgeyBAY2xhc3MgPSAidGV4dC1kYW5nZXIiIH0pDQogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgIEBIdG1sLkxhYmVsRm9yKG0gPT4gbS5Db2RlLCBuZXcgeyBAY2xhc3MgPSAiY29sLW1kLTIgY29udHJvbC1sYWJlbCIgfSkNCiAgICAgICAgPGRpdiBjbGFzcz0iY29sLW1kLTEwIj4NCiAgICAgICAgICAgIEBIdG1sLlRleHRCb3hGb3IobSA9PiBtLkNvZGUsIG5ldyB7IEBjbGFzcyA9ICJmb3JtLWNvbnRyb2wiIH0pDQogICAgICAgIDwvZGl2Pg0KICAgIDwvZGl2Pg0KICAgIDxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KICAgICAgICA8ZGl2IGNsYXNzPSJjb2wtbWQtb2Zmc2V0LTIgY29sLW1kLTEwIj4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNoZWNrYm94Ij4NCiAgICAgICAgICAgICAgICBASHRtbC5DaGVja0JveEZvcihtID0+IG0uUmVtZW1iZXJCcm93c2VyKQ0KICAgICAgICAgICAgICAgIEBIdG1sLkxhYmVsRm9yKG0gPT4gbS5SZW1lbWJlckJyb3dzZXIpDQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQogICAgPGRpdiBjbGFzcz0iZm9ybS1ncm91cCI+DQogICAgICAgIDxkaXYgY2xhc3M9ImNvbC1tZC1vZmZzZXQtMiBjb2wtbWQtMTAiPg0KICAgICAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCIgdmFsdWU9IlN1Ym1pdCIgLz4NCiAgICAgICAgPC9kaXY+DQogICAgPC9kaXY+DQp9DQoNCkBzZWN0aW9uIFNjcmlwdHMgew0KICAgIEBTY3JpcHRzLlJlbmRlcigifi9idW5kbGVzL2pxdWVyeXZhbCIpDQp9DQo=</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/authy2fa-csharp" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>